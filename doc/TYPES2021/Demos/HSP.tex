\section{Introduction}
The \agdaalgebras library is a repository of types and programs
(theorems and proofs) formalizing the foundations of universal algebra in Martin-L√∂f dependent type
theory using the \agda programming language.
The library now includes an fairly extensive collection of formal definitions, theorems, and
proofs that codify, in the formal language of type theory, the analogous definitions, theorems, and proofs of classical, informal universal algebra and equational logic based on set theory. As such, the library
provides many examples that exhibit the power of inductive and dependent types for
representing and reasoning about general algebraic and relational structures in a formal, machine-checkable language.

The first major milestone of this project is a new constructive proof of \emph{Birkhoff's variety theorem} (also known as the \emph{HSP theorem}), the first version of which was completed in January of 2021.\footnote{See \url{https://github.com/ualib/ualib.github.io/blob/b968e8af1117fc77700d3a588746cbefbd464835/sandbox/birkhoff-exp-new-new.lagda}}
To the best of our knowledge, this was the first formulation of Birkhoff's theorem in dependent type theory, and it was the first formal, machine-checked verification of the celebrated result of Birkhoff, first published in 1935~\cite{Birkhoff:1935}.

In this paper, we present a self-contained formal proof of Birkhoff's variety theorem by extracting into a single Agda module only those parts of the \agdaalgebras library that we needed for the proof of this classical result.  To keep the paper to a reasonable length, we have omit some of the formal proofs, but only those that are routine or overly technical and those that do not provide valuable insight into the important ideas of the proof. For those readers desiring more details, we have posted on the arXiv a long version of this paper, which includes every line of code of our formal proof of Birkhoff's theorem.

In the course presenting our formalization of the HSP theorem, we will highlight some of the more
challenging aspects of formalizing the basic definitions and theorems of \emph{universal algebra}
in type theory. In particular, we touch on some of the technical issues that arise when attempting
to constructively prove the foundational results of our field.  We believe this project provides
strong evidence in support of the claim that dependent type theory and the Agda language, despite
the technical demands they place on the user, are accessible to working mathematicians with sufficient
patience and a strong desire to codify their work in order to formally verify the their results.

Our presentation gives a sobering glimpse of the technical hurdles that must be overcome
to conduct research in mathematics using dependent type theory and the Agda language. Nonetheless we hope our work does not discourage anyone from investing in these technologies and we remain committed to the
use and promotion of type theory and proof assistants in general and in our own research.
Indeed, we are excited to share the gratifying outcomes and achievements
that resulted from attaining some degree of mastery of type theory, interactive theorem proving,
and the Agda language.

% <!-- ----------------------------------------------------------------------------------- -->

\section{Preliminaries}

\subsection{Logical foundations}

An Agda program typically begins by setting some language options and by
importing types from existing Agda libraries. The language options are specified
using the \ak{OPTIONS} \emph{pragma} which affect control the way Agda behaves by controlling
the deduction rules that are available to us and the logical axioms 
that are assumed when the program is type-checked by Agda to verify its
correctness. Every Agda program in the agda-algebras library, including the
present module (\DemosHSP), begins with the following line.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--without-K}\AgdaSpace{}%
\AgdaPragma{--exact-split}\AgdaSpace{}%
\AgdaPragma{--safe}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
\>[0]\<%
\end{code}
We give only very terse descriptions of these options, and refer the reader to
the accompanying links for more details.

\begin{itemize}
\item
\AgdaPragma{without-K} disables \href{https://ncatlab.org/nlab/show/axiom+K+%28type+theory%29}{Streicher's K axiom}.
See the \href{https://agda.readthedocs.io/en/v2.6.1/language/without-k.html}{section on axiom K} in the \href{https://agda.readthedocs.io/en/v2.6.1.3/language}{Agda Language Reference Manual}~\cite{agdaref-axiomk}.

\item
\AgdaPragma{exact-split} makes Agda accept only those definitions that behave like so-called {\it judgmental} equalities.
See the \href{https://agda.readthedocs.io/en/v2.6.1/tools/command-line-options.html#pattern-matching-and-equality}%
{Pattern matching and equality} section of the \href{https://agda.readthedocs.io/en/v2.6.1.3/tools/}{Agda Tools} documentation~\cite{agdatools-patternmatching}.

\item
\AgdaPragma{safe} ensures that nothing is postulated outright---every non-MLTT axiom has to be an explicit assumption (e.g., an argument to a function or module).
See the \href{https://agda.readthedocs.io/en/v2.6.1/tools/command-line-options.html#cmdoption-safe}{cmdoption-safe}
section of the \href{https://agda.readthedocs.io/en/v2.6.1.3/tools/}{Agda Tools documentation} and the \href{https://agda.readthedocs.io/en/v2.6.1/language/safe-agda.html#safe-agda}{Safe Agda section} of the \href{https://agda.readthedocs.io/en/v2.6.1.3/language}{Agda Language Reference}~\cite{agdaref-safeagda}.
\end{itemize}


The \AgdaKeyword{OPTIONS} pragma is usually followed by the start of a module and a list of import directives.
For example, the collection of imports required for the present module, \DemosHSP, is relatively modest and appears below.

\begin{code}[hide]%
\>[0]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{OPTIONS}\AgdaSpace{}%
\AgdaPragma{--without-K}\AgdaSpace{}%
\AgdaPragma{--exact-split}\AgdaSpace{}%
\AgdaPragma{--safe}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\end{code}
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaComment{--\ Import\ 3\ definitions\ from\ the\ agda-algebras\ library.}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Algebras.Basic}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaGeneralizable{ùìû}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaGeneralizable{ùì•}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Demos.HSP}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaGeneralizable{ùìû}\AgdaSpace{}%
\AgdaGeneralizable{ùì•}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaComment{--\ Import\ 16\ definitions\ from\ the\ Agda\ Standard\ Library.}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Data.Unit.Polymorphic}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{‚ä§}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{tt}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Function}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{flip}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚àò\AgdaUnderscore{}}}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Level}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaPostulate{Level}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.Definitions}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Reflexive}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Symmetric}%
\>[99]\AgdaSymbol{)}\<%
\\
%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Transitive}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Trans}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.PropositionalEquality}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚â°\AgdaUnderscore{}}}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Unary}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚äÜ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚àà\AgdaUnderscore{}}}%
\>[99]\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaComment{--\ Import\ 23\ definitions\ from\ the\ Agda\ Standard\ Library\ and\ rename\ 12\ of\ them.}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Agda.Primitive}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaPrimitive{Set}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{Type}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{\AgdaUnderscore{}‚äî\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaPrimitive{lsuc}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Data.Product}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{proj‚ÇÅ}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{fst}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{proj‚ÇÇ}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{snd}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}√ó\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œ£-syntax}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}%
\>[13]\AgdaModule{Function}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaRecord{Func}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaRecord{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaRecord{Injection}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaRecord{Surjection}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}%
\>[13]\AgdaModule{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{f}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{cong}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}%
\>[13]\AgdaModule{Setoid}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{reflÀ¢}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{symÀ¢}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{transÀ¢}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ¢\AgdaUnderscore{}}}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[99]\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}%
\>[13]\AgdaModule{IsEquivalence}%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{refl}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{refl·µâ}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{sym}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{sym·µâ}%
\>[58]\AgdaSymbol{)}\<%
\\
%
\>[29]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{trans}%
\>[47]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{trans·µâ}%
\>[58]\AgdaSymbol{)}%
\>[61]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\AgdaComment{--\ Assign\ handles\ to\ 3\ modules\ of\ the\ Agda\ Standard\ Library.}\<%
\\
\>[0]\AgdaKeyword{import}%
\>[13]\AgdaModule{Function.Definitions}%
\>[52]\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{FD}\<%
\\
\>[0]\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.PropositionalEquality}%
\>[52]\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{‚â°}\<%
\\
\>[0]\AgdaKeyword{import}%
\>[13]\AgdaModule{Relation.Binary.Reasoning.Setoid}%
\>[52]\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaKeyword{variable}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSpace{}%
\AgdaGeneralizable{Œ¥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µà}\AgdaSpace{}%
\AgdaGeneralizable{œÅ}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\<%
\\
%
\>[1]\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\<%
\\
%
\>[1]\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
\>[0]\<%
\end{code}
\fi
Note that the above imports include some adjustments to ``standard Agda'' syntax to suite our own taste.
In particular, the following conventions used throughout the \agdaalgebras library and this paper: we use \AgdaPrimitive{Type} in place of \AgdaPrimitive{Set}, the infix long arrow symbol,
\AgdaRecord{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}, instead of \AgdaRecord{Func} (the type of ``setoid functions'' discussed in ¬ß\ref{setoid-functions} below), and the symbol \aofld{\au{}‚ü®\$‚ü©\au{}} in place of \afld{f} (application of the map of a setoid function); we use
\AgdaField{fst} and \AgdaField{snd}, and sometimes \AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}} and
\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}}, to denote the first and second projections out of the product type \AgdaOperator{\AgdaFunction{\AgdaUnderscore{}√ó\AgdaUnderscore{}}}.
\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fst}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{snd}\<%
\end{code}

%% -----------------------------------------------------------------------------
\subsection{Setoids}
\label{setoids}
A \defn{setoid} is a pair (\ab A, \af{‚âà}) where \ab A is a type and \af{‚âà}
is an equivalence relation on \ab A. Setoids seem to have gotten a bad wrap
in some parts of the interactive theorem proving community because of the extra
overhead that their use requires. However, we feel they are ideally suited to
the task of representing the basic objects of informal mathematics (i.e., sets)
in a constructive, type-theoretic way.

A set used informally typically comes equipped with an equivalence relation manifesting
the notion of equality of elements of the set. When working informally, we
often take the equivalence for granted or view it as self-evident; rarely do we
take the time to define it explicitly. While this approach is well-suited to informal
mathematics, formalization using a machine demands that we make nearly everything
explicit, including notions of equality.

Actually, the \agdaalgebras library was first developed without setoids, relying exclusively
on the inductively defined equality type \ad{\au{}‚â°\au{}} from \am{Agda.Builtin.Equality},
along with some experimental, domain-specific types for equivalence classes, quotients, etc.
One notable consequence of this design decision was that our formalization of many
theorem required postulating function extensionality, an axiom that is not provable
in pure Martin-L√∂f type theory (MLTT). [reference needed]

In contrast, our current approach using setoids makes the equality relation
of a given type explicit.  A primary motivation for taking this approach is to make it
clear that the library is fully constructive and confined to pure Martin-L√∂f dependent type theory
(as defined, e.g., in [ref needed]). In particular, there are no appeals to function extensionality in the present work. Finally, we are confident that the current version\footnote{[ref. with version information needed]}  of the \agdaalgebras library is free of hidden assumptions or inconsistencies that could be
used to ``fool'' the type-checker.


%% -----------------------------------------------------------------------------
\subsection{Setoid functions}
\label{setoid-functions}
In addition to the \ar{Setoid} type, much of our code employs the
standard library's \ar{Func} type which represents a function from one
setoid to another and packages such a function with a proof (called \afld{cong}) that
the function respects the underlying setoid equalities. As mentioned above, we renamed
\ar{Func} to the more visually appealing infix long arrow symbol,
\AgdaRecord{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}, and  throughout the paper we
refer to inhabitants of this type as ``setoid functions.''

\ifshort\else
An example of a setoid function is the identity function from a setoid to itself.
We define it, along with a binary composition operation for setoid functions,
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ü®‚àò‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[9]\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[9]\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{C}%
\>[16]\AgdaSymbol{‚Üí}%
\>[19]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{B}%
\>[26]\AgdaSymbol{‚Üí}%
\>[29]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{C}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[18]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[18]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\fi

\paragraph*{Inverses of setoid functions}
We begin by defining an inductive type that represents the semantic concept of the \emph{image} of a function.\footnote{cf.~the \ualmodule{Overture.Func.Inverses} module of the \agdaalgebras library.}

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{B}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image\AgdaUnderscore{}‚àã\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚âà}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
\>[0]\<%
\end{code}
An inhabitant of \aod{Image} \ab f \aod{‚àã} \ab b is a dependent pair \AgdaPair{a}{p},
where \AgdaTyped{a}{A} and \ab p~\as :~\ab b \af{‚âà} \ab f~\ab a is a proof that
\ab f maps \ab a to \ab b.  Since the proof that \ab b
belongs to the image of \ab f is always accompanied by a witness \AgdaTyped{a}{A}, we can
actually \emph{compute} a range-restricted right-inverse of \ab f. For convenience, we define this
inverse function and give it the name \af{Inv}.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)\{}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
\>[0]\<%
\end{code}
For each \ab b : \afld{B}, given a pair \AgdaPair{a}{p}~\as :~\aod{Image}~\ab f~\aod{‚àã}~\ab b witnessing the fact that \ab b belongs to the image of \ab f, the function \af{Inv} simply returns the witness \ab a, which is a preimage of \ab b under \ab f.
We can formally verify that \af{Inv} \ab f is indeed the (range-restricted) right-inverse of \ab f, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{\}\{}\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{B}\AgdaSymbol{\}(}\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚âà}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaBound{p}\<%
\end{code}


\paragraph*{Injective and surjective setoid functions}
If \ab{f} % : \ab{ùë®} \aor{‚ü∂} \ab{ùë©}
is a setoid function from % \ab{ùë®} =
(\ab A, \af{‚âà‚ÇÄ}) to
% \ab{ùë©} =
(\ab B, \af{‚âà‚ÇÅ}), then we call \ab f \defn{injective} provided
\as{‚àÄ} (\ab{a‚ÇÄ} \ab{a‚ÇÅ} \as : \ab{A}), \ab{f} \aofld{‚ü®\$‚ü©} \ab{a‚ÇÄ} \af{‚âà‚ÇÅ} \ab{f} \aofld{‚ü®\$‚ü©} \ab{a‚ÇÅ}
implies \ab{a‚ÇÄ} \af{‚âà‚ÇÄ} \ab{a‚ÇÅ}; we call \ab{f} \defn{surjective} provided
\as{‚àÄ} (\AgdaTyped{b}{B}), \as{‚àÉ}~(\AgdaTyped{a}{A}) such that \ab{f} \aofld{‚ü®\$‚ü©} \ab{a} \af{‚âà‚ÇÅ} \ab{b}.
The \agdastdlib represents injective functions on bare types by the
type \af{Injective}, and uses this to define the \af{IsInjective} type to represent
the property of being an injective setoid function. Similarly, the type \af{IsSurjective}
represents the property of being a surjective setoid function. \af{SurjInv} represents the \emph{right-inverse} of a surjective function.
         %%%
\ifshort %%% BEGIN SHORT VERSION ONLY
         %%%
 We omit the relatively straightforward formal definitions of these types, but \seeunabridged, as well as formal proofs of some of their properties.
         %%%
\else    %%% END SHORT VERSION ONLY
         %%% BEGIN LONG VERSION ONLY SECTION
         %%%
 We reproduce the definitions and prove some of their properties
 inside the next submodule where we first set the stage by declaring two
 setoids \ab{ùë®} and \ab{ùë©}, naming their equality relations, and making some
 definitions from the standard library available.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÅ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FD}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚âà‚ÇÅ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÇ\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[26]\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Injective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[27]\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{fonto}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Inv}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{fonto}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{b}\AgdaSymbol{\})}\<%
\\
\>[0]\<%
\end{code}

Proving that the composition of injective setoid functions is again injective
is simply a matter of composing the two assumed witnesses to injectivity.
Proving that surjectivity is preserved under composition is only slightly more involved.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
%
\>[10]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaBound{ginj}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{ginj}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaBound{fonto}\AgdaSpace{}%
\AgdaBound{gonto}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Goal}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{mp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[2]\AgdaFunction{mp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaBound{fonto}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[3]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{Image}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚àã}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mp}\AgdaSpace{}%
\AgdaBound{gonto}\<%
\end{code}
         %%%
\fi      %%% END LONG VERSION ONLY SECTION
         %%%

\paragraph*{Kernels of setoid functions}
The \defn{kernel} of a function \ab f~\as :~\ab A~\as{‚Üí}~\ab B (where \ab A and \ab B are bare types) is defined
informally by \{\AgdaPair{x}{y} \aod{‚àà} \ab A \aof{√ó} \ab A \as : \ab f \ab x \as{=} \ab f \ab y \}.
This can be represented in Agda in a number of ways, but for our purposes it is most
convenient to define the kernel as an inhabitant of a (unary) predicate over the square of
the function's domain, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaGeneralizable{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{œÅ}\<%
\\
\>[0]\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaBound{‚âà}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\<%
\end{code}
The kernel of a \emph{setoid} function \ab f \as : \ab{ùê¥} \aor{‚ü∂} \ab{ùêµ} is \{\AgdaPair{x}{y} \as{‚àà} \ab A \aof{√ó} \ab A \as : \ab f \aofld{‚ü®\$‚ü©} \ab x \aofld{‚âà} \ab f \aofld{‚ü®\$‚ü©} \ab y\},
where \afld{\au{}‚âà\au} denotes equality in \ab{ùêµ}. This can be formalized in Agda as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùê¥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùêµ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùê¥}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{A}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ker}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùê¥}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaBound{ùêµ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\<%
\\
%
\>[1]\AgdaFunction{ker}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{ùêµ}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}


%% -------------------------------------------------------------------------------------

\section{Types for Basic Universal Algebra}
\label{types-for-basic-universal-algebra}
In this section we develop a working vocabulary and formal types for classical,
single-sorted, set-based universal algebra.
We cover a number of important concepts, but we limit ourselves to those
concepts required in our formal proof of Birkhoff's HSP theorem.
In each case, we give a type-theoretic version of the informal definition,
followed by a formal implementation of the definition in Martin-L√∂f dependent
type theory using the Agda language.

This section is organized into the following subsections:
¬ß\ref{signatures} defines a general notion of \emph{signature} of a structure and then defines a type that represent signatures;
¬ß\ref{algebras} does the same for \emph{algebraic structures} and \emph{product algebras};
¬ß\ref{homomorphisms} defines \emph{homomorphisms}, \emph{monomorphisms}, and \emph{epimorphisms}, presents types that codify these concepts and formally verifies some of their basic properties;
¬ß¬ß\ref{subalgebras}--\ref{terms} do the same for \emph{subalgebras} and \emph{terms}, respectively.


%% -----------------------------------------------------------------------------
\subsection{Signatures}
\label{signatures}

In model theory, the \defn{signature} \ab{ùëÜ} = (\ab{C}, \ab{F}, \ab{R}, \ab{œÅ})
of a structure consists of three (possibly empty) sets \ab{C}, \ab{F}, and
\ab{R}---called \emph{constant}, \emph{function}, and
\emph{relation} symbols, respectively---along with a function \ab{œÅ} : \ab{C} \as{+}
\ab{F} \as{+} \ab{R} \as{‚Üí} \ab{N} that assigns an \emph{arity} to each symbol. Often, but
not always, \ab{N} is taken to be the set of natural numbers.

As our focus here is universal algebra, we are more concerned with the
restricted notion of an \emph{algebraic signature}, that is, a signature for
``purely algebraic'' structures. Such a signature is a pair \ab{ùëÜ} = \AgdaPair{F}{œÅ}
where \ab{F} is a collection of \defn{operation symbols} and \ab{œÅ} : \ab{F} \as{‚Üí} \ab{N} is an \defn{arity function} which maps each operation symbol to its arity.
Here, \ab{N} denotes the \emph{arity type}. Heuristically, the arity
\ab{œÅ} \ab{f} of an operation symbol \ab{f} \as{‚àà} \ab{F} may be thought of as
the number of arguments that \ab{f} takes as ``input.''

The \agdaalgebras library represents an (algebraic) signature as an
inhabitant of the following dependent pair type:

\begin{center}

\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lsuc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{))}\\[4pt]
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{)}

\end{center}

Using special syntax for the first and second
projections---\AgdaOperator{\AgdaFunction{‚à£\AgdaUnderscore{}‚à£}} and
\AgdaOperator{\AgdaFunction{‚à•\AgdaUnderscore{}‚à•}} (resp.)---if
\ab{ùëÜ} \as{:} \af{Signature} \ab{ùìû} \ab{ùì•} is a signature, then
\aof{‚à£} \ab{ùëÜ} \aof{‚à£} denotes the set of operation symbols and \aof{‚à•} \ab{ùëÜ} \aof{‚à•} denotes the arity function.
Thus, if \ab{f} \as{:} \aof{‚à£} \ab{ùëÜ} \aof{‚à£} is an operation symbol in the
signature \ab{ùëÜ}, then \aof{‚à•} \ab{ùëÜ} \aof{‚à•} \ab{f} is the arity of \ab{f}.

We need to augment the ordinary \af{Signature} type so that it supports algebras over setoid domains.
To do so, we follow Andreas Abel's lead [ref needed] and define an operator that translates an
ordinary signature into a \defn{setoid signature}, that is, a signature over a setoid
domain. This raises a minor technical issue concerning the dependent types
involved in the definition; some readers might find the resolution of this issue instructive, so let's discuss it.

Suppose we are given two operations \ab{f} and \ab{g}, a tuple \ab{u} \as{:} \aof{‚à•} \ab{ùëÜ} \aof{‚à•} \ab{f} \as{‚Üí}
\ab{A} of arguments for \ab{f}, and a tuple \ab{v} \as{:} \aof{‚à•} \ab{ùëÜ}
\aof{‚à•} \ab{g} \as{‚Üí} \ab{A} of arguments for \ab{g}.  If we know that \ab f is identically equal to
\ab{g}---that is, \ab{f} \aod{‚â°} \ab{g} (intensionally)---then we should be able to
check whether \ab u and \ab v are pointwise equal.  Technically, though, \ab{u} and \ab{v} inhabit different types, so, before comparing them,
we must first convince Agda that \ab u and \ab v inhabit the same type. Of course,
this requires an appeal to the hypothesis \ab f \aod{‚â°} \ab g, as we see in the definition of \af{EqArgs} below
(adapted from Andreas Abel's development [ref needed]), which neatly resolves this minor technicality.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{EqArgs}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{\}\{}\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[10]\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{EqArgs}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

Finally, we are ready to define an operator which
translates an ordinary (algebraic) signature into a signature of algebras over setoids.
We denote this operator by \aof{‚ü®\AgdaUnderscore{}‚ü©} and define it as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{‚ü®\AgdaUnderscore{}‚ü©}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaField{Carrier}%
\>[9]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)}%
\>[34]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{.}\AgdaField{Carrier}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ¢\AgdaUnderscore{}}}%
\>[9]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{)(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{u}\AgdaSymbol{)(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSymbol{)}%
\>[34]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{eqv}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{EqArgs}\AgdaSymbol{\{}\AgdaArgument{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{eqv}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaBound{v}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaField{refl·µâ}%
\>[8]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{))}%
\>[60]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{reflÀ¢}%
\>[85]\AgdaBound{Œæ}\<%
\\
\>[0]\AgdaField{sym·µâ}%
\>[8]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}%
\>[60]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{symÀ¢}%
\>[85]\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{trans·µâ}%
\>[8]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaBound{Œæ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}%
\>[60]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{transÀ¢}%
\>[85]\AgdaBound{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\end{code}

%% -----------------------------------------------------------------------------
\subsection{Algebras}
\label{algebras}
Informally, an \defn{algebraic structure in the signature} \ab{ùëÜ} = (\ab{F}, \ab{œÅ}) (or \ab{ùëÜ}-\defn{algebra}) is denoted by \ab{ùë®} = (\ab{A}, \ab{F·¥¨}) and consists of
\begin{itemize}
\item a \emph{nonempty} set (or type) \ab A, called the \emph{domain} of the algebra;
\item a collection \ab{F·¥¨} := \{ \ab{f·¥¨} \as{‚à£} \ab f \as{‚àà} \ab F, \ab{f·¥¨} \as : (\ab{œÅ} \ab f \as{‚Üí} \ab A) \as{‚Üí} \ab A \} of \emph{operations} on \ab{A};
\item a (potentially empty) collection of \emph{identities} satisfied by elements and operations of \ab{ùë®}.
\end{itemize}
The \agdaalgebras library represents algebras as the inhabitants of a record type with two fields:
\begin{itemize}
\item \afld{Domain}, representing the domain of the algebra;
\item \afld{Interp}, representing the \emph{interpretation} in the algebra of each operation symbol in \ab{ùëÜ}.
\end{itemize}
The \afld{Domain} is a actually a setoid whose \afld{Carrier} denotes the carrier of the algebra and whose equivalence relation denotes equality of elements of the domain.

Here is the definition of the \ar{Algebra} type followed by an explaination of how the standard library's \ar{Func} type is used to represent the interpretation of operation symbols in an algebra.
%\footnote{We postpone introducing identities until they are needed (e.g., for equational logic); see~¬ß\ref{model-theory-and-equational-logic}.}

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaPrimitive{lsuc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{field}%
\>[8]\AgdaField{Domain}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
%
\>[8]\AgdaField{Interp}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaField{Domain}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaField{Domain}\<%
\\
\>[0]\<%
\end{code}
Recall, we renamed Agda's \ar{Func} type, prefering instead the long-arrow symbol \AgdaRecord{‚ü∂}, so
the \afld{Interp} field has type \ar{Func} (\aof{‚ü®} \ab{ùëÜ} \aof{‚ü©} \afld{Domain}) \afld{Domain}, a record type with two fields:
\begin{itemize}
\item a function  \ab{f} \as : \afld{Carrier} (\aof{‚ü®} \ab{ùëÜ} \aof{‚ü©} \afld{Domain})
  \as{‚Üí} \afld{Carrier} \afld{Domain} representing the operation;
\item a proof \af{cong} \as : \ab f \aof{Preserves \au{}‚âà‚ÇÅ\au{} ‚ü∂ \au{}‚âà‚ÇÇ\au{}} that the operation preserves the relevant setoid equalities.
\end{itemize}
Thus, for each operation symbol in the signature \ab{ùëÜ}, we have a setoid function \ab f---with domain a power of \afld{Domain} and codomain \afld{Domain}---along with a proof that this function respects the setoid equalities.  The latter means that the operation \ab{f} is accompanied by a proof of the following: ‚àÄ \ab u \ab v in \afld{Carrier} (\aof{‚ü®} \ab{ùëÜ} \aof{‚ü©} \afld{Domain}), if \ab u \af{‚âà‚ÇÅ} \ab v, then \ab{f} \aofld{‚ü®\$‚ü©} \ab{u} \af{‚âà‚ÇÇ} \ab{f} \aofld{‚ü®\$‚ü©} \ab{v}.

In the \agdaalgebras library is defined some syntactic sugar that helps to make our formalizations easier to read and
comprehend.
%\footnote{We omit the formal definitions, but see [reference needed].}
The following are three examples of such syntax that we use below: if \ab{ùë®} is an algebra, then
\begin{itemize}
\item \aof{ùîª[ \ab{ùë®} ]} denotes the setoid \afld{Domain} \ab{ùë®},
\item \aof{ùïå[ \ab{ùë®} ]} is the underlying carrier of the algebra \ab{ùë®}, and
\item \ab f \aof{ÃÇ} \ab{ùë®} denotes the interpretation in the algebra \ab{ùë®} of the operation symbol \ab f.
\end{itemize}
         %%%
\ifshort %%% BEGIN SHORT VERSION ONLY
         %%%
 We omit the straightforward formal definitions of these types, but \seeunabridged.
         %%%
\else    %%% END SHORT VERSION ONLY
         %%% BEGIN LONG VERSION ONLY SECTION
         %%%
\begin{code}%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Algebra}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùîª[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[23]\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùïå[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[23]\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}ÃÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}%
\>[48]\AgdaSymbol{‚Üí}%
\>[51]\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\end{code}

%% -----------------------------------------------------------------------------
\paragraph*{Universe levels of algebra types}
%\paragraph*{Agda's universe hierarchy}\label{agdas-universe-hierarchy}
The hierarchy of type universes in Agda is structured as follows:
\ap{Type} \ab{‚Ñì} : \ap{Type} (\ap{lsuc} \ab{‚Ñì}), \ap{Type} (\ap{lsuc} \ab{‚Ñì}) : \ap{Type} (\ap{lsuc} (\ap{lsuc} \ab{‚Ñì})), ‚Ä¶.
This means that \ap{Type} \ab{‚Ñì} has type \ap{Type} (\ap{lsuc} \ab{‚Ñì}), etc.  However, this does \emph{not} imply that
\ap{Type} \ab{‚Ñì} : \ap{Type} (\ap{lsuc} (\ap{lsuc} \ab{‚Ñì})). In other words, Agda's universe hierarchy is \emph{noncumulative}.
This can be advantageous as it becomes possible to treat universe levels more generally and precisely. On the other hand,
an unfortunate side-effect of this noncumulativity is that it sometimes seems unduly difficult to convince Agda that a program
or proof is correct.

This aspect of the language was one of the few stumbling blocks we encountered while learning how to use Agda for formalizing universal algebra in type theory.
Although some may consider this to be one of the least interesting and most annoying aspects of our work, others might find
this presentation most helpful if we resist the urge to gloss over the more technical and less elegant aspects of the library.
Therefore, we will show how to use the general universe lifting and lowering functions, available in the \agdastdlib,
to develop bespoke, domain-specific tools for dealing with the noncumulative universe hierarchy.

%\paragraph*{Lifting and lowering}
Let us be more concrete about what is at issue here by considering a typical example. Agda frequently encounters errors during the type-checking process and responds by printing an error message. Often the message has the following form.
{\color{red}{\small
\begin{verbatim}
  HSP.lagda:498,20-23
  Œ± != ùìû ‚äî ùì• ‚äî (lsuc Œ±) when checking that... has type...
\end{verbatim}}}
\noindent Here Agda informs us that it encountered universe level \ab{Œ±} on line 498 of the HSP module, where it was expecting level \ab{ùìû}~\aop{‚äî}~\ab{ùì•}~\aop{‚äî}~(\ap{lsuc} \ab{Œ±}).
For example, we may have tried to use an algebra inhabiting the type \ar{Algebra} \ab{Œ±} \ab{œÅ·µÉ} whereas we should have used one inhabiting the type \ar{Algebra} (\ab{ùìû} \aop{‚äî} \ab{ùì•} \aop{‚äî} (\ap{lsuc} \ab{Œ±})) \ab{œÅ·µÉ}.
One resolves such problems using the general \AgdaRecord{Lift} record type, available in the standard library, which takes a type inhabiting some universe and embeds it into a higher universe.
To apply this strategy in our domain of interest, we develop the following utility functions.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Level}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[10]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{la}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{lower}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{la}\AgdaSymbol{))}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{lab}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{lab}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[10]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Lift}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[37]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}%
\>[45]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[37]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}%
\>[45]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaField{lower}\<%
\\
%
\>[37]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)(}\AgdaField{lower}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{la}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{la}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{))(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{lab}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSymbol{(}\AgdaField{cong}\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{lab}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaBound{‚Ñì‚ÇÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÄ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÄ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{‚Ñì‚ÇÅ}\<%
\\
\>[0]\<%
\end{code}
To see why these functions are useful, first recall that our definition of the algebra record type uses two universe level parameters corresponding to those of the algebra's underlying domain setoid.
Concretely, an algebra of type \ar{Algebra} \ab{Œ±} \ab{œÅ·µÉ} has a domain setoid (called \afld{Domain}) of type \ar{Setoid} \ab{Œ±} \ab{œÅ·µÉ}. This domain setoid packages a ``carrier set'' (\afld{Carrier}),
inhabiting \ap{Type} \ab{Œ±}, with an equality on \afld{Carrier} of type \af{Rel} \afld{Carrier} \ab{œÅ·µÉ}. Now, examining the \af{Lift-Alg} function, we see that it
takes an algebra---one whose carrier set inhabits \ap{Type \ab{Œ±}} and has an equality of type \af{Rel} \afld{Carrier} \ab{œÅ·µÉ}---and constructs a new algebra with carrier set inhabiting \ap{Type} (\ab{Œ±} \ap{‚äî} \ab{‚Ñì‚ÇÄ}) and having an equality of type \af{Rel} \afld{Carrier} (\ab{œÅ·µÉ} \ap{‚äî} \ab{‚Ñì‚ÇÅ}).
Of course, this lifting operation would be useless if we couldn't establish a connection (beyond universe levels) between the input and output algebras.
Fortunately, we can prove that universe lifting is an \defn{algebraic invariant}, which is to say that the lifted algebra
has the same algebraic properties as the original algebra; more precisely, the input algebra and the lifted algebra are \defn{isomorphic}, as we prove below. (See \af{Lift-‚âÖ}.)
         %%%
\fi      %%% END LONG VERSION ONLY SECTION
         %%%

\paragraph*{Product Algebras}
We give an informal description of the \defn{product} of a family of \ab{ùëÜ}-algebras and then define a type which formalizes this notion.

Let \ab{Œπ} be a universe and \ab I~:~\ap{Type}~\ab{Œπ} a type (which, in the
present context, we might refer to as the ``indexing type'').
Then the dependent function type \ab{ùíú}~:~\ab
I~\as{‚Üí}~\ab{Algebra}~\ab{Œ±}~\ab{œÅ·µÉ} represents an \defn{indexed family of algebras}.
Denote by \af{‚®Ö}~\ab{ùíú} the \defn{product of algebras} in \ab{ùíú} (or \defn{product algebra}),
by which we mean the algebra whose domain is the Cartesian product \af{Œ†}~\ab
i~Íûâ~\ab I~\af{,}~\aof{ùîª[~\ab{ùíú}~\ab i~]} of the domains of the algebras in
\ab{ùíú}, and whose operations are those arising by point-wise interpretation in the obvious
way: if \ab{f} is a \ab J-ary operation symbol and if \ab a~:~\af{Œ†}~\ab
i~Íûâ~\ab I~\af{,}~\ab J~\as{‚Üí}~\aof{ùîª[~\ab{ùíú}~\ab i~]} is, for each \ab
i~:~\ab I, a \ab J-tuple of elements of the domain \aof{ùîª[~\ab{ùíú}~\ab i~]}, then
we define the interpretation of \ab f in \af{‚®Ö}~\ab{ùíú} by (\ab{f}~\af{ÃÇ}~\af{‚®Ö}~\ab{ùíú}) \ab a := \as{Œª}~(\ab i~:~\ab I)~\as{‚Üí} (\ab{f}~\af{ÃÇ}~\ab{ùíú}~\ab i)(\ab{a}~\ab i).

The \agdaalgebras library defines a function called \af{‚®Ö} which formalizes the foregoing notion of \defn{product algebra} in Martin-L√∂f type theory.
\ifshort
Here we merely display this function's interface, but see the \ualmodule{Algebras.Func.Products} module for the complete definition.

\else
\fi
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\<%
\end{code}
\ifshort\else
\begin{code}%
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[1112I]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[.][@{}l@{}]\<[1112I]%
\>[9]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ¢\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{b}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[9]\AgdaSymbol{;}%
\>[1139I]\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1139I][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaKeyword{record}%
\>[20]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[42]\AgdaField{refl·µâ}%
\>[50]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\<%
\\
%
\>[20]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[42]\AgdaField{sym·µâ}%
\>[50]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[20]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[42]\AgdaField{trans·µâ}%
\>[50]\AgdaSymbol{(}\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{flip}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{f=g}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{flip}\AgdaSpace{}%
\AgdaBound{f=g}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi




%% -------------------------------------------------------------------------------------

\subsection{Homomorphisms}
\label{homomorphisms}

%\paragraph*{Basic definitions}
Suppose \ab{ùë®} and \ab{ùë©} are \ab{ùëÜ}-algebras. A \defn{homomorphism} (or
``hom'') from \ab{ùë®} to \ab{ùë©} is a setoid function
\ab{h}~:~\aof{ùîª[ \ab{ùë®} ]} \as{‚Üí} \aof{ùîª[ \ab{ùë©} ]} that is \defn{compatible}
(or \defn{commutes}) with all basic operations; that is,
for every operation symbol \ab{f}~:~\af{‚à£ \ab{ùëÜ} ‚à£} and all tuples
\ab{a}~:~\af{‚à• \ab{ùëÜ} ‚à•}~\ab{f} \as{‚Üí} \aof{ùîª[ \ab{ùë®} ]}, the following
equality holds: \ab{h} \aofld{‚ü®\$‚ü©} (\ab{f}~\af{ÃÇ}~\ab{ùë®}) \ab{a} \af{‚âà}
(\ab{f}~\af{ÃÇ}~\ab{ùë©}) \as{Œª} \ab{x} \as{‚Üí} \ab{h} \aofld{‚ü®\$‚ü©} (\ab{a} \ab{x}).

To formalize this concept in Agda, we first define a type \af{compatible-map-op}
representing the assertion that a given setoid function
\ab{h}~:~\aof{ùîª[ \ab{ùë®} ]} \as{‚Üí} \aof{ùîª[ \ab{ùë©} ]} commutes with a given
basic operation \ab{f}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{compatible-map-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{compatible-map-op}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
Generalizing over operation symbols gives the following type of compatible maps
from (the domain of) \ab{ùê¥} to (the domain of) \ab{ùë©}.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{compatible-map-op}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{f}\<%
\\
\>[0]\<%
\end{code}
With this we define a record type \ar{IsHom} representing the property of being
a homomorphism, and finally the type \af{hom} of homomorphisms from \ab{ùë®} to \ab{ùêµ}.
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{field}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaRecord{IsHom}\<%
\\
\>[0]\<%
\end{code}
Observe that an inhabitant of \af{hom} is a pair (\ab h , \ab p) whose first component is a setoid function from the domain of \ab{ùë®} to that of \ab{ùë©} and whose second component is \ab p : \ar{IsHom} \ab h, a proof that \ab h is a homomorphism.

A \defn{monomorphism} (resp. \defn{epimorphism}) is an injective (resp. surjective) homomorphism.  The \agdaalgebras library defines types \ar{IsMon} and \ar{IsEpi} to represent these properties, as well as
\af{mon} and \af{epi}, the types of monomorphisms and epimorphisms, respectively.
\ifshort %%% BEGIN SHORT VERSION ONLY
We won't reproduce the formal definitions of these types here, but \seeunabridged.
\else    %%% BEGIN LONG VERSION ONLY
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsMon}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{field}%
\>[9]\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\>[9]\AgdaField{isInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\<%
\\
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{mon}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{mon}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaRecord{IsMon}\<%
\\
\>[0]\<%
\end{code}
As with \af{hom}, the type \af{mon} is a dependent product type; each inhabitant is a pair consisting of a setoid function, say, \ab h, along with a proof that \ab h is a monomorphism.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{field}%
\>[9]\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\>[9]\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaBound{h}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\<%
\\
%
\>[2]\AgdaFunction{HomReduct}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{epi}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{Œ£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaRecord{IsEpi}\<%
\end{code}

Here are two mere utilities that are useful for translating between types.

\begin{code}%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsHom}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsMon}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{IsEpi}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{mon‚Üíintohom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{mon}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{mon‚Üíintohom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hhM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{hhM}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isInjective}\AgdaSpace{}%
\AgdaBound{hhM}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{epi‚Üíontohom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{epi‚Üíontohom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hhE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{hhE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaBound{hhE}\<%
\end{code}

\paragraph*{Composition of homomorphisms}
         %%%
\fi      %%% END LONG VERSION ONLY SECTION
         %%%

The composition of homomorphisms is again a homomorphism, and similarly for epimorphisms (and monomorphisms).
\ifshort
The proofs of these facts are relatively straightforward so we omit them. When applied below, they are called \af{‚àò-hom} and \af{‚àò-epi}.
\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
%
\>[10]\AgdaSymbol{\{}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{\}\{}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaBound{ghom}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{compatible}\AgdaSpace{}%
\AgdaBound{ghom}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{compatible}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{‚àò-is-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{‚àò-is-epi}\AgdaSpace{}%
\AgdaBound{gE}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[27]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{gE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSymbol{)}\<%
\\
%
\>[27]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaBound{gE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}%
\>[29]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
%
\>[2]\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ghom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-is-hom}\AgdaSpace{}%
\AgdaBound{hhom}\AgdaSpace{}%
\AgdaBound{ghom}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{‚àò-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë™}%
\>[29]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
%
\>[2]\AgdaFunction{‚àò-epi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hepi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{gepi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®‚àò‚ü©}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-is-epi}\AgdaSpace{}%
\AgdaBound{hepi}\AgdaSpace{}%
\AgdaBound{gepi}\<%
\end{code}

\paragraph*{Universe lifting of homomorphisms}
Here we define the identity homomorphism for setoid algebras. Then we prove that the operations of lifting and lowering of a setoid algebra are homomorphisms.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùëñùëë}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[54]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÅ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}%
\>[54]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âàÀ°\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{reflÀ°}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}%
\>[54]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà ≥\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl ≥}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Level}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{reflÀ°}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToFromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[22]\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âàÀ°}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{ToFromLiftÀ°}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromToLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÅ}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[1]\AgdaFunction{FromToLiftÀ°}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{lower}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{reflÀ°}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToFromLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà ≥}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{ToFromLift ≥}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromToLift ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÅ}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[1]\AgdaFunction{FromToLift ≥}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl‚ÇÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[35]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[35]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}%
\>[7]\AgdaModule{Level}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToFromLift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[1]\AgdaFunction{ToFromLift}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{lift}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ToLift-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ToLift-epi}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}%
\>[28]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{isHom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{ToLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[28]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{FromLift}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ToFromLift}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}

\paragraph*{Homomorphisms of product algebras}
%\label{homomorphisms-of-product-algebras}
Suppose we have an algebra \ab{ùë®}, a type \ab I : \ap{Type} \ab{ùìò}, and a family \ab{‚Ñ¨} : \ab I \as{‚Üí} \ar{Algebra} \ab{Œ≤} \ab{œÅ·µá} of algebras.
We sometimes refer to the inhabitants of \ab{I} as \emph{indices}, and call \ab{‚Ñ¨} an \defn{indexed family of algebras}. If in addition we have a family \ab{ùíΩ} : (\ab i : \ab I) ‚Üí \af{hom} \ab{ùë®} (\ab{‚Ñ¨} \ab i) of homomorphisms, then we can construct a homomorphism from \ab{ùë®} to the product \af{‚®Ö} \ab{‚Ñ¨} in the natural way.  The latter is codified in dependent type theory by the function \af{‚®Ö-hom-co} defined below.\footnote{cf.~the \ualmodule{Homomorphisms.Func.Products} module of the \agdaalgebras library.}

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}%
\>[74]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚®Ö-hom-co}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚®Ö-hom-co}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hhom}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\>[2]\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{h}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùíΩ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\end{code}

\paragraph*{Factorization of homomorphisms}
         %%%
\fi      %%% END LONG VERSION ONLY SECTION
         %%%

Another basic but important fact about homomorphisms is the following factorization theorem: if \ab g : \af{hom} \ab{ùë®} \ab{ùë©}, \ab h : \af{hom} \ab{ùë®} \ab{ùë™}, \ab h is surjective,
and \af{ker} \ab h \aof{‚äÜ} \af{ker} \ab g, then there exists \ab{œÜ} : \af{hom} \ab{ùë™} \ab{ùë©}
such that \ab g = \ab{œÜ} \aof{‚àò} \ab h.  The type \af{HomFactor}, defined below, formalizes this result in MLTT.
         %%%
\ifshort %%% BEGIN SHORT VERSION ONLY
         %%%
Here we merely give a formal statement of this theorem.
%, but \seeunabridged or the\ualmodule{Homomorphisms.Func.Factor} module of the \agdaalgebras library.
         %%%
\else\fi %%% END SHORT VERSION ONLY

\begin{AgdaAlign}
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[2098I]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[2098I]%
\>[9]\AgdaSymbol{(}\AgdaBound{gh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{gfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{gfunc}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{HomFactor}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[14]\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚âà‚ÇÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{kernel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚âà‚ÇÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{g}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{‚Üí}%
\>[14]\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaSymbol{‚Üí}%
\>[14]\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÇ}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{a}\<%
\end{code}
\ifshort\else
\begin{code}%
%
\>[1]\AgdaFunction{HomFactor}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaBound{hE}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{œÜhom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{gœÜh}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{kerpres}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a‚ÇÄ}\AgdaSpace{}%
\AgdaBound{a‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{a‚ÇÄ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{a‚ÇÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaBound{a‚ÇÄ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÇ}}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaBound{a‚ÇÅ}\<%
\\
%
\>[2]\AgdaFunction{kerpres}\AgdaSpace{}%
\AgdaBound{a‚ÇÄ}\AgdaSpace{}%
\AgdaBound{a‚ÇÅ}\AgdaSpace{}%
\AgdaBound{hyp}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaBound{hyp}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaBound{hE}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaBound{c}\<%
\\
%
\>[2]\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaBound{hE}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÉ}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{h‚Åª¬π}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaFunction{Œ∂}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}‚ü∂\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{œÜcong}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{gœÜh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÇ}}\AgdaSpace{}%
\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[2]\AgdaFunction{gœÜh}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Khg}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÜcomp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{œÜmap}\<%
\\
%
\>[2]\AgdaFunction{œÜcomp}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[3][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{œÜmap}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}%
\>[40]\AgdaBound{c}%
\>[48]\AgdaFunction{‚âàÀò‚ü®}%
\>[53]\AgdaFunction{œÜcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ∑}\AgdaSymbol{))}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSymbol{(}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{)))}%
\>[48]\AgdaFunction{‚âàÀò‚ü®}%
\>[53]\AgdaFunction{œÜcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSymbol{(}\AgdaFunction{h‚Åª¬π}\AgdaSymbol{(}\AgdaFunction{h}\AgdaSymbol{(}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{))))}%
\>[48]\AgdaFunction{‚âàÀò‚ü®}%
\>[53]\AgdaFunction{gœÜh}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaFunction{h‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{))}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{g}\AgdaSymbol{(}%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{))}%
\>[48]\AgdaFunction{‚âà‚ü®}%
\>[53]\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}%
\>[97]\AgdaFunction{‚ü©}\<%
\\
%
\>[14]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}%
\>[23]\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[31]\AgdaFunction{h‚Åª¬π}%
\>[36]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[39]\AgdaBound{c}%
\>[42]\AgdaSymbol{))}%
\>[48]\AgdaOperator{\AgdaFunction{‚àé}}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÜhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{œÜmap}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaFunction{œÜhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{œÜcomp}\<%
\end{code}

\paragraph*{Isomorphisms}
\fi      %%% END LONG VERSION ONLY SECTION
\end{AgdaAlign}

\ifshort \medskip \else \fi

Two structures are \defn{isomorphic} provided there are homomorphisms going back and forth between them which compose to the identity map.
\ifshort
The \agdaalgebras library's \ar{\au{}‚âÖ\au{}} type codifies the definition of isomorphism, as well as some obvious consequences.  Here we display only the core part of this record type, but \seeunabridged or the \ualmodule{Homomorphisms.Func.Isomorphisms} module of the \agdaalgebras library.
\else    %%% BEGIN LONG VERSION ONLY
This notion is formalized in the \agdaalgebras library as the record type \ar{\au{}‚âÖ\au{}}, whose definition we present below.  Note that the definition includes statements and proofs of some easy consequences---namely, that the maps back-and-forth are bijective. This makes it easy to apply these facts when they are needed.
\fi %%% END SHORT VERSION ONLY
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·¥Æ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{constructor}%
\>[15]\AgdaInductiveConstructor{mkiso}\<%
\\
%
\>[2]\AgdaKeyword{field}%
\>[15]\AgdaField{to}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\<%
\\
%
\>[15]\AgdaField{from}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[15]\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[41]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[56]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}%
\>[64]\AgdaOperator{\AgdaFunction{‚âà·¥Æ}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[15]\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[41]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\>[56]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}%
\>[64]\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else    %%% BEGIN LONG VERSION ONLY
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[2]\AgdaFunction{toIsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{toIsSurjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{toIsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{toIsInjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{fromIsSurjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{fromIsSurjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{fromIsInjective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{fromIsInjective}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà·¥Æ}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{Œæ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaOperator{\AgdaModule{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{‚âÖ-refl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Reflexive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaFunction{‚âÖ-refl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{‚âÖ-sym}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaFunction{‚âÖ-sym}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{‚âÖ-trans}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaRecord{\AgdaUnderscore{}‚âÖ\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaGeneralizable{Œ±}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaGeneralizable{Œ≥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaFunction{‚âÖ-trans}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œÅ·∂ú}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÅ·∂ú}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaFunction{œÑ}\AgdaSpace{}%
\AgdaFunction{ŒΩ}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë™}%
\>[29]\AgdaSymbol{;}%
\>[32]\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[2]\AgdaFunction{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSymbol{)}%
\>[29]\AgdaSymbol{;}%
\>[32]\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà·∂ú\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{trans·∂ú}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{œÑ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà·∂ú}}\AgdaSpace{}%
\AgdaBound{b}\<%
\\
%
\>[2]\AgdaFunction{œÑ}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans·∂ú}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to‚àºfrom}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{ŒΩ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{a}\<%
\\
%
\>[2]\AgdaFunction{ŒΩ}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{from}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{bc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from‚àºto}\AgdaSpace{}%
\AgdaBound{ab}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

Fortunately, the lift operation \af{Lift-Alg} that we defined above is an \emph{algebraic invariant}, by which we mean that isomorphism classes of algebras are closed under \af{Lift-Alg}.
As our focus is universal algebra, this crucial property is why we can use the lift operation
to solve the technical problems arising from the noncumulativity of Agda's universe
hierarchy without changing the algebraic semantics.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{Lift-‚âÖÀ°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-AlgÀ°}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{Lift-‚âÖÀ°}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{ToLiftÀ°}\AgdaSpace{}%
\AgdaFunction{FromLiftÀ°}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ToFromLiftÀ°}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{FromToLiftÀ°}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSymbol{\})}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{Lift-‚âÖ ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg ≥}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{Lift-‚âÖ ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaFunction{ToLift ≥}\AgdaSpace{}%
\AgdaFunction{FromLift ≥}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ToFromLift ≥}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{FromToLift ≥}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSymbol{\})}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Lift-‚âÖ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{Lift-‚âÖ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÖ-trans}\AgdaSpace{}%
\AgdaFunction{Lift-‚âÖÀ°}\AgdaSpace{}%
\AgdaFunction{Lift-‚âÖ ≥}\<%
\\
\>[0]\<%
\end{code}
\fi      %%% END LONG VERSION ONLY SECTION

We conclude this section on homomorphisms with what seems, for our purposes, the most useful way to represent the class of \emph{homomorphic images} of an algebra in dependent type theory.\footnote{Here and throughout the \agdaalgebras library, we use the following shorthand: for any level \ab{Œ±}, let \af{ov} \ab{Œ±} = \ab{ùí™} \ap{‚äî} \ab{ùí±} \ap{‚äî} \ab{Œ±}.}
%%The first function, \af{ov}, merely provides a handy shorthand for universe levels.)
%\footnote{cf.~the \ualmodule{Homomorphisms.Func.HomomorphicImages} module of the \agdaalgebras library.}

\begin{code}[hide]%
\>[0]\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPostulate{Level}\<%
\\
\>[0]\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaPrimitive{lsuc}\AgdaSpace{}%
\AgdaBound{Œ±}\<%
\end{code}

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}IsHomImageOf\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{HomImages}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaFunction{HomImages}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSymbol{\}\{}\AgdaArgument{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\<%
\end{code}
For future reference we record the fact that an algebra is its own homomorphic image.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{IdHomImage}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaFunction{IdHomImage}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ±}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaInductiveConstructor{Image\AgdaUnderscore{}‚àã\AgdaUnderscore{}.eq}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Domain}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\ifshort\else    %%% BEGIN LONG VERSION ONLY

\medskip

\noindent These types should be self-explanatory, but just to be sure, we pause
to describe the semantics of the Sigma type appearing in the definition of \af{HomImages}.
If \ab{ùë®} : \af{Algebra} \ab{Œ±} \ab{œÅ·µÉ} is an \ab{ùëÜ}-algebra, then \af{HomImages} \ab{ùë®}
denotes the type of pairs (\ab{ùë©} \aic{,} \ab p) such that \ab{ùë©} : \ar{Algebra} \ab{Œ≤} \ab{œÅ·µá}
and \ab p is a proof that there exists a homomorphism from \ab{ùë®} onto \ab{ùë©}.
\fi      %%% END LONG VERSION ONLY SECTION

%% -------------------------------------------------------------------------------------
\subsection{Subalgebras}
\label{subalgebras}
%\paragraph*{Basic definitions}
%\label{subalgebras-basic-definitions}
Given \ab{ùëÜ}-algebras \ab{ùë®} and \ab{ùë©}, we say that \ab{ùë®} is a \defn{subalgebra} of \ab{ùë®} and write
\ab{ùë®}~\aof{‚â§}~\ab{ùë©} just in case \ab{ùë®} can be \emph{homomorphically embedded} in \ab{ùë©}; in other terms,
\ab{ùë®}~\aof{‚â§}~\ab{ùë©} iff there exists an injective homomorphism from \ab{ùë®} to \ab{ùë©}.
The following definition codifies the \defn{binary subalgebra relation},
\aof{\au{}‚â§\au{}}, on the class of \ab{ùëÜ}-algebras.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚â§\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\end{code}

Obviously the subalgebra relation is reflexive by the identity monomorphism; it is
also transitive since composition of monomorphisms is a monomorphism.
\ifshort
Here we merely give the formal statements of these assertions, omitting the easy proofs.
\else\fi

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{‚â§-reflexive}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\AgdaFunction{‚â§-reflexive}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùíæùíπ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{id}\<%
\end{code}
\fi
\begin{code}%
\>[0]\AgdaFunction{‚â§-transitive}%
\>[14]\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[17]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\end{code}

\ifshort\else
\begin{code}%
\>[0]\AgdaFunction{‚â§-transitive}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ginj}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{finj}\AgdaSpace{}%
\AgdaBound{ginj}\<%
\end{code}
\fi

If
\ab{ùíú} : \ab I ‚Üí \af{Algebra} \ab{Œ±} \ab{œÅ·µÉ} and
\ab{‚Ñ¨} : \ab I ‚Üí \af{Algebra} \ab{Œ≤} \ab{œÅ·µá} are families of \ab{ùëÜ}-algebras such that
\ab{‚Ñ¨} \ab i \af{‚â§} \ab{ùíú} \ab i for all \ab i : \ab I, then \af{‚®Ö} \ab{‚Ñ¨} is a subalgebra
of \af{‚®Ö} \ab{ùíú}.
\ifshort
The formal statement of this fact is given below, without proof.
\else
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{\}\{}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚®Ö-‚â§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\<%
\end{code}
\ifshort\else
\begin{code}%
%
\>[1]\AgdaFunction{‚®Ö-‚â§}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hhom}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hM}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{hi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{‚Ñ¨}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{hi}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaFunction{hM}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{IsInjective}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaFunction{hM}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{xy}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\fi
We conclude this brief subsection on subalgebras with
\ifshort
a function that merely converts a monomorphism into a pair in the subalgebra relation.
The easy proof is omitted.
\else
two easy facts
that will be useful later. The first merely converts a monomorphism into a pair in the subalgebra relation
while the second is an algebraic invariance property of \AgdaOperator{\AgdaFunction{\au{}‚â§\au{}}}.
\fi

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{mon‚Üí‚â§}%
\>[11]\AgdaSymbol{:}%
\>[14]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{mon}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë©}\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\AgdaFunction{mon‚Üí‚â§}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mon‚Üíintohom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{‚âÖ-trans-‚â§}%
\>[11]\AgdaSymbol{:}%
\>[14]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[14]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë™}\<%
\\
\>[0]\AgdaFunction{‚âÖ-trans-‚â§}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{hinj}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{to}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚àò-IsInjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaField{to}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{toIsInjective}\AgdaSpace{}%
\AgdaBound{A‚âÖB}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{hinj}\AgdaSymbol{)}\<%
\end{code}
\fi

%% -------------------------------------------------------------------------------------

\subsection{Terms}
\label{terms}
%\paragraph*{Basic definitions}
Fix a signature \ab{ùëÜ} and let \ab X denote an arbitrary nonempty collection of variable symbols.
(The chosen collection of variable symbols is sometimes called the \defn{context}.)
Assume the symbols in \ab X are distinct from the operation symbols of \ab{ùëÜ}, that is \ab X \aof{‚à©} \aof{‚à£} \ab{ùëÜ} \aof{‚à£} = ‚àÖ.

A \defn{word} in the language of \ab{ùëÜ} is a finite sequence of members of \ab X \aof{‚à™} \aof{‚à£} \ab{ùëÜ} \aof{‚à£}. We denote the concatenation of such sequences by simple juxtaposition.
Let \ab{S‚ÇÄ} denote the set of nullary operation symbols of \ab{ùëÜ}. We define by induction on \ab n the sets \ab{ùëá‚Çô} of \emph{words} over \ab X \aof{‚à™} \aof{‚à£} \ab{ùëÜ} \aof{‚à£} as follows (cf.~\cite[Def. 4.19]{Bergman:2012}): \ab{ùëá‚ÇÄ} := \ab X \aof{‚à™} \ab{S‚ÇÄ} and \ab{ùëá‚Çô‚Çä‚ÇÅ} := \ab{ùëá‚Çô} \aof{‚à™} \ab{ùíØ‚Çô},
where \ab{ùíØ‚Çô} is the collection of all \ab f \ab t such that \ab f : \aof{‚à£} \ab{ùëÜ} \aof{‚à£} and \ab t : \aof{‚à•} \ab{ùëÜ} \aof{‚à•} \ab f \as{‚Üí} \ab{ùëá‚Çô}. (Recall, \aof{‚à•} \ab{ùëÜ} \aof{‚à•} \ab f is the arity of the operation symbol \ab f.) An \ab{ùëÜ}-\defn{term} is a term in the language of \ab{ùëÜ} and the collection of all \ab{ùëÜ}-\defn{terms} in the context \ab X is given by \Term{X} := \aof{‚ãÉ‚Çô} \ab{ùëá‚Çô}.

As even its informal definition of \Term{X} is recursive, it should come as no surprise that
the semantics of terms can be faithfully represented in type theory as an inductive type.
Indeed, here is such a representation.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}%
\>[39]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[1]\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\<%
\end{code}
This is a very basic inductive type that represents each term as a tree with an operation symbol at each \aic{node} and a variable symbol at each leaf (\aic{‚Ñä}); hence the constructor names (\aic{‚Ñä} for ``generator'' and \aic{node} for ``node''). We will enrich this type with an inductive type \ad{\au{}‚âÉ\au{}} representing equality of terms, and then we will package up \ad{Term}, \ad{\au{}‚âÉ\au{}}, and a proof that \ad{\au{}‚âÉ\au{}} is an equivalence relation into a setoid of \ab{ùëÜ}-terms.
Ultimately we will use this term setoid as the domain of an algebra---the (absolutely free) \emph{term algebra} in the signature \ab{ùëÜ}.

First, the equality-of-terms type is defined as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
One can easily show that equality of terms so defined is an equivalence relation%
\ifshort
; the proof is trivial, so we omit it, but give it the name \af{‚âÉ-isEquiv} for future reference.
\else
, as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚âÉ-isRefl}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Reflexive}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ-isSym}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Symmetric}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚â°.sym}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ-isTrans}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Transitive}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚â°.trans}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ-isEquiv}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}%
\>[29]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ-isEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isSym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isTrans}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\fi

\paragraph*{The term algebra}
For a given signature \ab{ùëÜ}, if the type \Term{X} is nonempty (equivalently, if \ab X or
\aof{‚à£~\ab{ùëÜ}~‚à£} is nonempty), then we can define an algebraic structure, denoted by \T{X}
and called the \defn{term algebra in the signature} \ab{ùëÜ} \defn{over} \ab X.  Terms are
viewed as acting on other terms, so both the elements of the carrier of \T{X} and its
basic operations are the terms themselves.

For each operation symbol \ab f : \aof{‚à£~\ab{ùëÜ}~‚à£}, we denote by \ab f~\aof{ÃÇ}~\T{X} the
operation on \Term{X} that maps each tuple of terms, say,
\ab t : \aof{‚à•~\ab{ùëÜ}~‚à•} \ab f \as{‚Üí} \Term{X}, to the formal term \ab f \ab t.
We let \T{X} denote the term algebra in \ab{ùëÜ} over \ab X; it has universe \Term{X} and
operations \ab f \aof{ÃÇ} \T{X}, one for each symbol \ab f in \aof{‚à£~\ab{ùëÜ}~‚à£}.
Finally, we formalize this notion of term algebra in \agda as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{TermSetoid}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{TermSetoid}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isEquiv}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaField{Algebra.Domain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{TermSetoid}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaField{Algebra.Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\<%
\\
\>[0]\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Algebra.Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ss‚âÉts}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{ss‚âÉts}\<%
\end{code}

\paragraph*{Environments and the interpretation of terms therein}
In this section, we formalize the notions \emph{environment} and \emph{interpretation of terms} in an algebra, evaluated in an environment. The approach to formalizing these notions, as well as the Agda code presented in this subsection, is based on similar code developed by Andreas Abel to formalize Birkhoff's completeness theorem~\cite{Abel:2021}.

\ifshort\else
Recall that the domain of an algebra \ab{ùë®} is a setoid, which we denote by \af{ùîª[ \ab{ùë®} ]}, whose \afld{Carrier} is the universe of the algebra, \af{ùïå[~\ab{ùë®}~]}, and whose equivalence relation represents equality of elements in \af{ùïå[~\ab{ùë®}~]}.
\fi

Fix a signature \ab{ùëÜ}, a context of variable symbols \ab X, and an \ab{ùëÜ}-algebra \ab{ùë®}. An \defn{environment} for these data is a function \ab{œÅ} : \ab X \as{‚Üí} \af{ùïå[~\ab{ùë®}~]} which assigns a value in the universe to each variable symbol in the context.
We represent the notion of environment in Agda using a function, \af{Env}, which takes an algebra \ab{ùë®} and a context \ab{X} and returns a setoid whose \afld{Carrier} has type \ab X \as{‚Üí} \af{ùïå[~\ab{ùë®}~]} and whose equivalence relation is pointwise equality of functions in \ab X \as{‚Üí} \af{ùïå[~\ab{ùë®}~]} (relative to the setoid equality of \af{ùîª[~\ab{ùë®}~]}).

Before defining the \af{Env} function (which will depend on a specific algebra) we first define a substitution from one context, say, \ab X, to another \ab Y, which assigns a term in \ab X to each symbol in \ab Y.  The definition of \af{Sub} (which does not depend on a specific algebra) is a slight modification of the one given by Andreas Abel (\textit{op.~cit.}), as is the recursive definition of the syntax \ab t \af{[~\ab{œÉ}~]}, which denotes a term \ab t applied to a substitution \ab{œÉ}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

Now we are ready to define the aforementioned environment function \af{Env}
as well as the recursive function \af{‚ü¶\au{}‚üß} which defines the \defn{interpretation} of
a term in a given algebra, \emph{evaluated} in a given environment.  Since the next few
definitions are relative to a certain fixed algebra, we put them inside a submodule called
\am{Environment} so that later, when we load the environment, we can associate its
definitions with different algebras.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{Env}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[17]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[17]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[17]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}%
\>[43]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}%
\>[52]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}%
\>[63]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[43]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}%
\>[52]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}%
\>[63]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[43]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}%
\>[52]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}%
\>[63]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)(}\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[18]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[18]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{u‚âàv}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{u‚âàv}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{x‚âày}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{args}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{x‚âày}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}

Two terms interpreted in \ab{ùë®} are proclaimed \defn{equal} if they are equal for all environments.  This equivalence of terms%
\ifshort\else
, and proof that it is an equivalence relation,
\fi
~is formalized in Agda as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{‚Ñä}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{\AgdaUnderscore{})}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaInductiveConstructor{‚Ñä}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaSymbol{\AgdaUnderscore{})}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{s}\AgdaSymbol{)(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSymbol{(}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else %The proof that \af{Equal} is an equivalence relation is trivial, so we omit it.
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{IsEquivalence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œì}\AgdaSymbol{\})}\<%
\\
%
\>[1]\AgdaField{refl·µâ}%
\>[9]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}%
\>[35]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaField{sym·µâ}%
\>[9]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x=y}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[35]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x=y}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaField{trans·µâ}%
\>[9]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{ij}\AgdaSpace{}%
\AgdaBound{jk}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[35]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ij}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{jk}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\fi

A substitution from one context \ab X to another \ab Y is used to transport an environment from \ab X to \ab Y and the function \af{‚ü¶\au{}‚üß}
\ifshort
(whose formal definition we omit)
\else
defined below
\fi
carries out this transportation of environments.
\ifshort\else

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üßs}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßs}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}
\fi
The \defn{substitution lemma} says that \aof{‚ü¶~\ab{t}~[~\ab{œÉ}~]~‚üß} \aofld{‚ü®\$‚ü©} \ab{œÅ} (the
term \ab{t} applied to a substitution \ab{œÉ}, evaluated in an evironment \ab{œÅ}) is the
same as \aof{‚ü¶~\ab{t}~‚üß} \aofld{‚ü®\$‚ü©} \aof{‚ü¶~\ab{œÉ}~‚üßs} \ab{œÅ} (the term \ab{t} evaluated
in the \ab{œÉ}-transported environment).
\ifshort
As its proof is a simple recursion, we omit it and merely display the formal statement of the
substitution lemma.
\else\fi

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[17]\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaField{Carrier}\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{‚Üí}%
\>[17]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßs}}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[27]\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}%
\>[27]\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ts}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\fi
This concludes the definition of the \am{Environment} module based on~\cite{Abel:2021} (\textit{op.~cit.}).

\ifshort\else
\paragraph*{Compatibility of terms}
\fi
We will need two important facts about term operations.  The first, called
\af{comm-hom-term}, asserts that every term commutes with every homomorphism.  The second,
\af{interp-prod}, shows how to express the interpretation of a term in a product algebra.
\ifshort
We omit the formalization of these facts, but see the \ualmodule{Types.Func.Properties}
module of the \agdaalgebras library for details.
\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}(}\AgdaBound{hh}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥Æ}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[1]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥Æ}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}%
\>[29]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}%
\>[29]\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{h}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}%
\>[36]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaField{compatible}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{))}%
\>[36]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaField{cong}\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSymbol{)(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥Æ}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSymbol{)}%
\>[36]\AgdaOperator{\AgdaFunction{‚àé}}\AgdaSpace{}%
\AgdaKeyword{where}%
\>[45]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[23]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}%
\>[23]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[37]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[57]\AgdaOperator{\AgdaFunction{‚âà}}%
\>[61]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[1]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[25]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{i}%
\>[34]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚âÉ‚ÜíEqual}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[1]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}%
\>[25]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[34]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{j}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi

\section{Equational Logic}
\label{equational-logic}

\paragraph*{Term identities, equational theories, and the ‚äß relation}
Given a signature \ab{ùëÜ} and a context \ab X, an \ab{ùëÜ}-\defn{term equation} or \ab{ùëÜ}-\defn{term identity}
is an ordered pair (\ab p , \ab q) of ùëÜ-terms.\footnote{Such pairs of terms are also denoted by \ab p \af{‚âà} \ab
q and are often simply called equations or identities, especially when the signature \ab{ùëÜ} is obvious.}
For instance, if the context is the type \ab X : \ap{Type} \ab{œá}, then a term equation
is a pair inhabiting the Cartesian product type \ad{Term}~\ab{X} \aof{√ó} \ad{Term}~\ab{X}.

We define an \defn{equational theory} (or \defn{algebraic theory}) to be a pair \ab{T} =
(\ab{ùëÜ} , \ab{‚Ñ∞·µÄ}) consisting of a signature \ab{ùëÜ} and a collection \ab{‚Ñ∞·µÄ} of
\ab{ùëÜ}-term equations. Some authors reserve the term \defn{theory} for
a \emph{deductively closed} set of equations, that is, a set of equations that is closed
under \emph{entailment} (defined below).

We say that the algebra \ab{ùë®} \emph{satisfies} the equation \ab p \af{‚âà} \ab q if,
for all \ab{œÅ} : \ab X \as{‚Üí} \aof{ùîª[~\ab{ùë®}~]},
%(assigning values in the domain of \ab{ùë®} to variable symbols in \ab X)
we have \aof{‚ü¶~\ab{p}~‚üß} \aofld{‚ü®\$‚ü©} \ab{œÅ} \af{‚âà} \aof{‚ü¶~\ab{q}~‚üß} \aofld{‚ü®\$‚ü©} \ab{œÅ}.
In other words, when they are interpreted in the algebra \ab{ùë®},
the terms \ab{p} and \ab{q} are equal no matter what values in \ab{ùë®} are assigned to variable symbols in \ab{X}.
In this situation, we write
\ab{ùë®}~\aof{‚äß}~\ab{p}~\aof{‚âà}~\ab{q} and say that \ab{ùë®} \defn{models} \ab{p}~\af{‚âà}~\ab{q},
or that \ab{ùë®} is a \defn{model} of \ab{p}~\af{‚âà}~\ab{q}
If \ab{ùí¶} is a class of algebras, all of the same signature, we write \ab{ùí¶}~\aof{‚ä´}~\ab{p}~\aof{‚âà}~\ab{q}
and say that \ab{ùí¶} \defn{models} the identity \ab{p}~\af{‚âà}~\ab{q} provided for every \ab{ùë®} \aof{‚àà} \ab{ùí¶},
we have \ab{ùë®}~\aof{‚äß}~\ab{p}~\aof{‚âà}~\ab{q}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚äß\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä´\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
\>[0]\<%
\end{code}
We represent a collection of identities as a predicate over pairs of
terms, say, \ab{‚Ñ∞} : \af{Pred}(\ad{Term} \ab{X} \af{√ó} \ad{Term} \ab{X})  and we denote by
\ab{ùë®}~\aof{‚ä®}~\ab{‚Ñ∞} the assertion that the algebra \ab{ùë®} models \ab{p}~\af{‚âà}~\ab{q}
for all pairs (\ab{p} , \ab{q}) \af{‚àà} \ab{‚Ñ∞}.\footnote{Notice that \af{‚ä®} is
a stretched version of the models symbol, \af{‚äß}; this makes it easier to distinguish the types
\af{\au{}‚ä®\au{}} and \af{\au{}‚äß\au{}‚âà\au{}}. The first denotes models of \emph{collections} of equations,
while the latter denotes models of a \emph{single} equation. In Emacs
\texttt{agda2-mode}, the unicode symbol \af{‚äß} is produced by typing
\textbackslash{}models, while \af{‚ä®} is produced with \textbackslash\textbar{}=.}

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä®\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä®}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\<%
\end{code}

In (informal) equational logic, if \ab{ùí¶} is a class of structures and \ab{‚Ñ∞} a set of
term identities, then the set of term equations modeled by \ab{ùí¶} is denoted
\af{Th}~\ab{ùí¶} and called the \defn{equational theory} of \ab{ùí¶}, while the class of
structures modeling \ab{‚Ñ∞} is denoted by \af{Mod}~\ab{‚Ñ∞} and is called the
\defn{equational class axiomatized} by \ab{‚Ñ∞}. These notions may be formalize in type
theory as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
\>[0]\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Equal}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\<%
\end{code}

\paragraph*{Entailment}

If \ab{‚Ñ∞} is a set of \ab{ùëÜ}-term equations and \ab{p} and \ab{q} are \ab{ùëÜ}-terms,
we say that \ab{‚Ñ∞} \defn{entails} the equation \ab{p}~\aof{‚âà}~\ab{q}, and we write
\ab{‚Ñ∞}~\ad{‚ä¢}~\ab{p}~\ad{‚âà}~\ab{q}, just in case every model of \ab{‚Ñ∞} also models
\ab{p}~\aof{‚âà}~\ab{q}.

We represent entailment in type theory using an inductive type that is similar to
the one defined by Andreas Abel, which he used in~\cite{Abel:2021} to formalizing
Birkhoff's completeness theorem.  We call this the \defn{entailment type} and define it as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}‚ä¢\AgdaUnderscore{}‚ñπ\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[14]\AgdaSymbol{(}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
%
\>[14]\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaInductiveConstructor{hyp}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{Y}\AgdaSymbol{\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaInductiveConstructor{app}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{Y}\AgdaSymbol{\}\{}\AgdaBound{ps}%
\>[4304I]\AgdaBound{qs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{\}}\<%
\\
\>[4304I][@{}l@{\AgdaIndent{0}}]%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{ps}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{qs}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaBound{ps}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaGeneralizable{ùëì}\AgdaSpace{}%
\AgdaBound{qs}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaInductiveConstructor{sub}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Sub}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œî}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaInductiveConstructor{reflexive}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\>[1]\AgdaInductiveConstructor{symmetric}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\>[1]\AgdaInductiveConstructor{transitive}%
\>[13]\AgdaSymbol{:}%
\>[16]\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{r}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{r}\<%
\\
\>[0]\<%
\end{code}

The fact that this type represents the informal semantic notion of entailment
given at the start of this subsection is called the \defn{soundness} and
\defn{completeness} of entailment.
More precisely, \defn{the entailment type is sound} means that
\ab{‚Ñ∞}~\ad{‚ä¢}~\ab p~\ad{‚âà}~\ab q implies \ab p \aof{‚âà} \ab q holds in
every algebra that models \ab{‚Ñ∞}.
\defn{The entailment type is complete} means
that if \ab p \aof{‚âà} \ab q holds in every algebra that models of \ab{‚Ñ∞},
then \ab{‚Ñ∞}~\ad{‚ä¢}~\ab p~\aof{‚âà}~\ab q.

We will invoke soundness of the entailment type only once below%
\ifshort
~(by the name \af{sound}), so we omit its straightforward formalization.
\else
; nonetheless, here is its formalization, due to Abel~\cite{Abel:2021}.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Soundness}%
\>[18]\AgdaSymbol{(}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{))}\<%
\\
%
\>[18]\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}%
\>[52]\AgdaComment{--\ We\ assume\ an\ algebra\ ùë®}\<%
\\
%
\>[18]\AgdaSymbol{(}\AgdaBound{V}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{Y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚ä®\AgdaUnderscore{}}}\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚Ñ∞}\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSymbol{\}))}%
\>[52]\AgdaComment{--\ that\ models\ all\ equations\ in\ ‚Ñ∞.}\<%
\\
%
\>[18]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaGeneralizable{Œì}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{hyp}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{i}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{app}\AgdaSpace{}%
\AgdaBound{es}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{es}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{sub}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}%
\>[8]\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[15]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaBound{œÅ}%
\>[32]\AgdaFunction{‚âà‚ü®}%
\>[37]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[59]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}%
\>[15]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßs}}%
\>[29]\AgdaBound{œÅ}%
\>[32]\AgdaFunction{‚âà‚ü®}%
\>[37]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßs}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[59]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}%
\>[15]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üßs}}%
\>[29]\AgdaBound{œÅ}%
\>[32]\AgdaFunction{‚âàÀò‚ü®}%
\>[37]\AgdaFunction{substitution}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{œÅ}%
\>[59]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}%
\>[8]\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[15]\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaBound{œÅ}%
\>[32]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{reflexive}%
\>[20]\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}}%
\>[44]\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{refl·µâ}%
\>[56]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{symmetric}%
\>[20]\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}%
\>[35]\AgdaBound{Epq}%
\>[44]\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{sym·µâ}%
\>[56]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}%
\>[84]\AgdaSymbol{(}\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{transitive}%
\>[20]\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}\{}\AgdaBound{r}\AgdaSymbol{\}}%
\>[35]\AgdaBound{Epq}\AgdaSpace{}%
\AgdaBound{Eqr}%
\>[44]\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{trans·µâ}%
\>[56]\AgdaFunction{EqualIsEquiv}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}\{}\AgdaBound{r}\AgdaSymbol{\}}%
\>[84]\AgdaSymbol{(}\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Epq}\AgdaSymbol{)(}\AgdaFunction{sound}\AgdaSpace{}%
\AgdaBound{Eqr}\AgdaSymbol{)}\<%
\end{code}
\fi

\paragraph*{The Closure Operators H, S, P and V}
Fix a signature \ab{ùëÜ}, let \ab{ùí¶} be a class of \ab{ùëÜ}-algebras, and define
\begin{itemize}
\item \af H \ab{ùí¶} = algebras isomorphic to homomorphic images of members of \ab{ùí¶};
\item \af S \ab{ùí¶} = algebras isomorphic to subalgebras of a members of \ab{ùí¶};
\item \af P \ab{ùí¶} = algebras isomorphic to products of members of \ab{ùí¶}.
\end{itemize}
A straight-forward verification confirms that \af H, \af S, and \af P are \emph{closure operators} (expansive, monotone, and idempotent).  A class \ab{ùí¶} of \ab{ùëÜ}-algebras is said to be \emph{closed under the taking of homomorphic images} provided \af H \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}. Similarly, \ab{ùí¶} is \emph{closed under the taking of subalgebras} (resp., \emph{arbitrary products}) provided \af S \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶} (resp., \af P \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}). The operators \af H, \af S, and \af P can be composed with one another repeatedly, forming yet more closure operators.

% An algebra is a homomorphic image (resp., subalgebra; resp., product) of every algebra to which it is isomorphic. Thus, the class \af H \ab{ùí¶} (resp., \af S \ab{ùí¶}; resp., \af P \ab{ùí¶}) is closed under isomorphism.

A \emph{variety} is a class of \ab{ùëÜ}-algebras that is closed under the taking of
homomorphic images, subalgebras, and arbitrary products.  To represent varieties
we define types for the closure operators \af H, \af S, and \af P that are composable.
Separately, we define a type \af V which represents closure under all three
operators, \af H, \af S, and \af P.  Thus, if \ab{ùí¶} is a class of \ab{ùëÜ}-algebras, then
\af V \ab{ùí¶} := \af H (\af S (\af P \ab{ùí¶})), and \ab{ùí¶} is a variety iff \af V \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}.

We now define the type \af H to represent classes of algebras that include all homomorphic images of algebras in the class---i.e., classes that are closed under the taking of homomorphic images---the type \af S to represent classes of algebras that closed under the taking of subalgebras, and the type \af P to represent classes of algebras closed under the taking of arbitrary products.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{H}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{H}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{S}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
Finally, we define the \defn{varietal closure} of a class \ab{ùí¶} to be the class \af{V} \ab{ùí¶} := \af{H} (\af{S} (\af{P} \ab{ùí¶})).
(Recall, \ab{ùí¶} is called a \defn{variety} if \af{V} \ab{ùí¶} = \ab{ùí¶}.)
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\AgdaSpace{}%
\AgdaBound{Œ≥}\AgdaSpace{}%
\AgdaBound{œÅ·∂ú}\AgdaSpace{}%
\AgdaBound{Œ¥}\AgdaSpace{}%
\AgdaBound{œÅ·µà}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ≤}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µá}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{V}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[46]\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ¥}\AgdaSpace{}%
\AgdaBound{œÅ·µà}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{H}\AgdaSymbol{\{}\AgdaBound{Œ≥}\AgdaSymbol{\}\{}\AgdaBound{œÅ·∂ú}\AgdaSymbol{\}\{}\AgdaBound{Œ¥}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µà}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{b}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSymbol{\{}\AgdaBound{Œ≤}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
As mentioned, \af S is a closure operator. In particular, it is idempotent;
\ifshort
that is, \af{S-idem} : \af{S} (\af{S} \ab{ùí¶}) \af{‚äÜ} \af{S} \ab{ùí¶}. We omit the proof of this basic fact.
\else
we formalize this fact as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{S-idem}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[10]\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}%
\>[31]\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}}\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{Œ≥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{S-idem}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sB}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚â§B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x‚â§A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{sB}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚â§-transitive}\AgdaSpace{}%
\AgdaBound{x‚â§A}\AgdaSpace{}%
\AgdaBound{A‚â§B}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\fi

An important property of the binary relation \aof{‚äß} is \emph{algebraic invariance} (i.e.,
invariance under isomorphism).
\ifshort
Here is the formal statement of this property, without proof.
\else
We formalize this property as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{)(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚äß-I-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}%
\>[24]\AgdaSymbol{‚Üí}%
\>[27]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[34]\AgdaSymbol{‚Üí}%
\>[37]\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
\>[0]\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{‚äß-I-invar}\AgdaSpace{}%
\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaBound{f‚àºg}\AgdaSpace{}%
\AgdaBound{g‚àºf}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[32]\AgdaBound{œÅ}%
\>[37]\AgdaFunction{‚âàÀò‚ü®}%
\>[42]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f‚àºg}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{f}%
\>[22]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âàÀò‚ü®}%
\>[42]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{f}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âà‚ü®}%
\>[42]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{f}\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âà‚ü®}%
\>[42]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{f}%
\>[22]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaSymbol{(}\AgdaFunction{g}%
\>[29]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[32]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[37]\AgdaFunction{‚âà‚ü®}%
\>[42]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f‚àºg}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[6]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[14]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[32]\AgdaBound{œÅ}%
\>[37]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{fh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{gh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[25]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥¨}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[25]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\<%
\end{code}
\fi
Identities modeled by an algebra \ab{ùë®} are also modeled by every homomorphic image of
\ab{ùë®} and by every subalgebra of \ab{ùë®}.
\ifshort
We refer to these facts as \af{‚äß-H-invar} and \af{‚äß-S-invar}, but omit their formal
statements and proofs, which are analogous to those of \af{‚äß-I-invar}.
\else
These facts are formalized in Agda as follows.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}\{}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚äß-H-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-H-invar}\AgdaSpace{}%
\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{œÜE}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[33]\AgdaBound{œÅ}%
\>[38]\AgdaFunction{‚âàÀò‚ü®}%
\>[43]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaBound{œÜE}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[38]\AgdaFunction{‚âàÀò‚ü®}%
\>[43]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{œÜ}\AgdaSymbol{(}%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[38]\AgdaFunction{‚âà‚ü®}%
\>[43]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaFunction{œÜ}\AgdaSymbol{(}%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{))}%
\>[38]\AgdaFunction{‚âà‚ü®}%
\>[43]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[25]\AgdaFunction{œÜ‚Åª¬π}%
\>[30]\AgdaOperator{\AgdaFunction{‚àò}}%
\>[33]\AgdaBound{œÅ}\AgdaSymbol{)}%
\>[38]\AgdaFunction{‚âà‚ü®}%
\>[43]\AgdaField{cong}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{InvIsInverse ≥}\AgdaSpace{}%
\AgdaBound{œÜE}\AgdaSymbol{)}%
\>[79]\AgdaFunction{‚ü©}\<%
\\
%
\>[7]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[15]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[33]\AgdaBound{œÅ}%
\>[38]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{œÜ‚Åª¬π}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SurjInv}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜE}\<%
\\
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œÜh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥¨}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{‚äß-S-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-S-invar}\AgdaSpace{}%
\AgdaBound{Apq}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaBound{b}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}%
\>[5043I]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[.][@{}l@{}]\<[5043I]%
\>[4]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaFunction{‚âà‚ü®}%
\>[36]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{b}%
\>[58]\AgdaFunction{‚ü©}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaFunction{‚âà‚ü®}%
\>[36]\AgdaBound{Apq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{b}\AgdaSymbol{)}%
\>[58]\AgdaFunction{‚ü©}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß·¥¨}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaFunction{‚âàÀò‚ü®}%
\>[36]\AgdaFunction{comm-hom-term}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{b}%
\>[58]\AgdaFunction{‚ü©}\<%
\\
%
\>[4]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{(}%
\>[9]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}%
\>[17]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[27]\AgdaBound{b}\AgdaSymbol{)}%
\>[31]\AgdaOperator{\AgdaFunction{‚àé}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß·¥¨}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë©}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{hh}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
\>[0]\<%
\end{code}
\fi
An identity satisfied by all algebras in an indexed collection is
also satisfied by the product of algebras in the collection.
\ifshort
We refer to this fact as \af{‚äß-P-invar}.
\else

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{\}(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{‚äß-P-invar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{‚äß-P-invar}\AgdaSpace{}%
\AgdaBound{ùíúpq}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß‚ÇÅ}}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaBound{a}%
\>[46]\AgdaFunction{‚âà‚ü®}%
\>[51]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{a}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[46]\AgdaFunction{‚âà‚ü®}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíúpq}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[46]\AgdaFunction{‚âàÀò‚ü®}%
\>[51]\AgdaFunction{interp-prod}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaBound{a}%
\>[70]\AgdaFunction{‚ü©}\<%
\\
%
\>[3]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß‚ÇÅ}}%
\>[24]\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}%
\>[29]\AgdaBound{a}%
\>[46]\AgdaOperator{\AgdaFunction{‚àé}}\<%
\\
%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSymbol{)}%
\>[26]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß‚ÇÅ}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}%
\>[26]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[26]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{SetoidReasoning}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\<%
\end{code}
\fi

The classes \af H \ab{ùí¶}, \af S \ab{ùí¶}, \af P \ab{ùí¶}, and \af V \ab{ùí¶} all satisfy the
same set of equations.  We will only use a subset of the inclusions needed to prove this
assertion, and we present here only the facts we need.\footnote{For more details, see the
\ualmodule{Varieties.Func.Preservation} module of the \agdaalgebras library.}
First, the closure operator \af H preserves the identities modeled by the
given class; this follows almost imediately from the invariance lemma
\af{‚äß-H-invar} proved above.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{H-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{H}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{H-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{BimgOfA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-H-invar}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{BimgOfA}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}
The analogous preservation result for \af S is a simple consequence of
the invariance lemma \af{‚äß-S-invar}; the obvious converse, which we call
\af{S-id2}, has an equally straightforward proof.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{S-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{S-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{B‚â§A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-S-invar}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{B‚â§A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{S-id2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[1]\AgdaFunction{S-id2}\AgdaSpace{}%
\AgdaBound{Spq}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Spq}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚â§-reflexive}\AgdaSymbol{))}\<%
\\
\>[0]\<%
\end{code}
Finally, we have analogous pairs of implications for \af P and \af V.
\ifshort
Here we give their formal statements without proof.
\else
In each case, we will only need the first implication, so we omit the others from this presentation.
\fi
\begin{AgdaAlign}
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{P-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{Œπ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{P}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\end{code}
\ifshort\else
\begin{code}%
%
\>[1]\AgdaFunction{P-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚âÖ‚®ÖA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-I-invar}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚âÖ-sym}\AgdaSpace{}%
\AgdaBound{A‚âÖ‚®ÖA}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚äß-P-invar}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{kA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{Œπ}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{V-id1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\end{code}
\ifshort\else
\begin{code}%
%
\>[1]\AgdaFunction{V-id1}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚â§‚®ÖA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{BimgA}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{H-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSymbol{\}\{}\AgdaArgument{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{spK‚äßpq}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{spA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{BimgA}\AgdaSymbol{))}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaFunction{spA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{spA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p‚®ÖA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{A‚â§‚®ÖA}\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{spK‚äßpq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[3]\AgdaFunction{spK‚äßpq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{a‚ÑìŒπ}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÉ}\AgdaSymbol{)}\<%
\end{code}
\fi
\end{AgdaAlign}

%% -------------------------------------------------------------------------------------

\section{Free Algebras}
\label{free-algebras}
\paragraph*{The absolutely free algebra}
The term algebra \af{ùëª} \ab X is \emph{absolutely free} (or \emph{universal}, or
\emph{initial}) for algebras in the signature \ab{ùëÜ}. That is, for every
\ab{ùëÜ}-algebra \ab{ùë®}, the following hold.

\begin{itemize}
\item Every function from \ab{X} to \af{ùïå[ \ab{ùë®} ]} lifts to a homomorphism from \af{ùëª} \ab{X} to \ab{ùë®}.
\item The homomorphism that exists by the previous item is unique.
\end{itemize}

We now prove the first of these facts in \agda.\footnote{For the proof of uniqueness, see the \ualmodule{Terms.Func.Properties} module of the \agdaalgebras library.}
%, starting with the fact that every map from \ab{X} to
%\af{ùïå[ \ab{ùë®} ]} lifts to a map from \af{ùïå[ \T{X} ]} (= \af{Term} \ab{X}) to
%\af{ùïå[ \ab{ùë®} ]} in a natural way, by induction on the structure of the given term.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}(}\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{t}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{flcong}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{reflexive}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{reflexive·¥¨}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{s}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âÉ}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{s}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}.rfl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{reflexive·¥¨}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚â°.cong}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{\AgdaUnderscore{}‚âÉ\AgdaUnderscore{}.gnl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{flcong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)))}\<%
\\
\>[0]\<%
\end{code}
Naturally, at the base step of the induction, when the term has the form \aic{‚Ñä}
\ab x, the free lift of \ab h agrees with \ab h.  For the inductive step, when the
given term has the form \aic{node} \ab f \ab t, the free lift is defined as
follows: Assuming (the induction hypothesis) that we know the image of each
subterm \ab t \ab i under the free lift of \ab h, define the free lift at the
full term by applying \ab f \aof{ÃÇ} \ab{ùë®} to the images of the subterms.
The free lift so defined is a homomorphism by construction. Indeed, here is the trivial proof.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hhom}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{hfunc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{hcomp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{compatible-map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\<%
\\
%
\>[2]\AgdaFunction{hcomp}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{free-lift-func}\AgdaSymbol{)\{}\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{‚âÉ-isRefl}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsHom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{hfunc}\<%
\\
%
\>[2]\AgdaFunction{hhom}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaSymbol{(Œª\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hcomp}\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{a}\AgdaSymbol{\})}\<%
\\
\>[0]\<%
\end{code}

It turns out, the interpretation of a term \ab p in an environment \ab{Œ∑} is the same as the free lift of \ab{Œ∑} evaluated at \ab p.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{œá}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[21]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[21]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)(}\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\<%
\\
%
\>[1]\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[1]\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaBound{Œ∑}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSymbol{)}\<%
\end{code}

\paragraph*{The relatively free algebra in theory}

In this subsection, we describe, for a given class \ab{ùí¶} of \ab{ùëÜ}-algebras, the \emph{relatively free algebra} in \af{S} (\af{P} \ab{ùí¶}) over \ab X, using the standard, informal language that is typically used in mathematics literature. In the next section we will present the same material using Agda and the formal language of type theory.

Above we defined the term algebra \T{X}, which is free in the class of all \ab{ùëÜ}-algebras; that is, \T{X} has the universal property and belongs to the class of \ab{ùëÜ}-algebras.  Given an arbitrary class \ab{ùí¶} of \ab{ùëÜ}-algebras, we can't expect that \T{X} belongs to \ab{ùí¶}, so, in general, we say that \T{X} is free \emph{for} \ab{ùí¶}.  Indeed, it might not be possible to find a free algebra that belongs to \ab{ùí¶}.  However, for any class \ab{ùí¶} we can construct an algebra that is free \emph{for} \ab{ùí¶} and belongs to the class \af{S} (\af{P} \ab{ùí¶}), and this often suffices.

The informal construction of the free algebra in \af{S} (\af{P} \ab{ùí¶}), for an arbitrary class \ab{ùí¶} of \ab{ùëÜ}-algebras, often proceeds by way of a quotient.  We let \af{Œò} := \af{‚ãÇ}\{\ab{Œ∏} \af{‚àà} \af{Con} (\T{X}) : \T{X} \af{/} \ab{Œ∏} \af{‚àà} \af{S} \ab{ùí¶}\},\footnote{\af{Con} (\T{X}) is the set of congruences of \T{X}.} and define the \defn{relatively free algebra over} \ab{X} (relative to \ab{ùí¶}) to be the quotient of \T{X} modulo the congruence \af{Œò}, which we denote by \Free{X} := \T{X} \af{/} \ab{Œò}. It's not hard to see that \Free{X} is a subdirect product of the algebras in \{\T{X} \af{/} \ab{Œ∏}\}, where \ab{Œ∏} ranges over all
congruences modulo which \T{X} belongs to \af{S}~\ab{ùí¶}.
Thus \Free{X} belongs to \af{P}(\af{S}~\ab{ùí¶}) ‚äÜ \af{S}(\af{P}~\ab{ùí¶}), and it follows that \Free{X} satisfies the identities in \af{Th} \ab{ùí¶} (those modeled by all members of \ab{ùí¶}).  Indeed, for each pair \ab p \ab q : \Term{X}, if \ab{ùí¶} \af{‚ä´} \ab p \af{‚âà} \ab q, then \ab p and \ab q must belong to the same \ab{Œò}-class, so \ab p and \ab q are identified in \Free{X}.
\ifshort\else (Notice that \af{Œò} may be empty, in which case \af{œà} = \T{X} \af{√ó} \T{X} and then \T{X} \af{/} \ab{œà} is trivial.) \fi


\paragraph*{The relatively free algebra in Agda}
We now define the relatively free algebra in Agda using the language of type theory.
Our approach will be different from the informal one described above in that we start with
a set (or, rather, a type) \ab{‚Ñ∞} of identities, instead of a class of algebras, and we
avoid quotients altogether, in favor of setoids. The domain of the free algebra will be a
setoid whose \afld{Carrier} is the type \Term{X} of {ùëÜ}-terms in \ab X and whose
equivalence relation will include all pairs (\ab p , \ab q) \af{‚àà} \Term{X} \af{√ó}
\Term{X} such that \ab p \aod{‚âà} \ab q is derivable from \ab{‚Ñ∞}; that is, \ab{‚Ñ∞} \aod{‚ä¢}
\ab X \aod{‚ñπ} \ab p \aod{‚âà} \ab q. Finally, the interpretation of an operation in the free
algebra is simply the operation itself, which works since \ab{‚Ñ∞} \aod{‚ä¢} \ab X
\aod{‚ñπ\au{}‚âà\au{}} is a congruence relation.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{œá}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}(}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Setoid}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{record}%
\>[10]\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\<%
\\
%
\>[10]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{isEquivalence}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{reflexive}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{sym}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{symmetric}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{trans}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{transitive}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{œá}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\<%
\\
%
\>[1]\AgdaField{Domain}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[1]\AgdaField{Interp}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{FreeInterp}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü®}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaFunction{FreeDomain}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[2]\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{ts}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ts}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{FreeInterp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{h}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{app}\AgdaSpace{}%
\AgdaBound{h}\<%
\end{code}

\paragraph*{The natural epimorphism} % from ùëª X to ùîΩ[ X ]}
We now define the natural epimorphism from \T{X} onto the relatively free algebra \Free{X} and prove that
the kernel of this morphism is the congruence of \T{X} defined by the identities modeled by (\af S \ab{ùí¶}, hence by) \ab{ùí¶}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{FreeHom}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{epiF[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{epiF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{hepi}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[27]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}%
\>[43]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÄ\AgdaUnderscore{}}}%
\>[67]\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl·µÄ}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[27]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}%
\>[43]\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà‚ÇÅ\AgdaUnderscore{}}}%
\>[67]\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÄ}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà‚ÇÅ}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[2]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rfl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaInductiveConstructor{‚â°.refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\>[2]\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{gnl}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{f}\AgdaSymbol{\}\{}\AgdaBound{s}\AgdaSymbol{\}\{}\AgdaBound{t}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{con}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àò}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{f}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{con}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{hepi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{h}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaFunction{hepi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{h}\AgdaSpace{}%
\AgdaFunction{refl·µÄ}\<%
\\
%
\>[2]\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaFunction{hepi}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaOperator{\AgdaFunction{homF[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{IsEpi.HomReduct}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{epiF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{kernel-in-theory}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{kernel-in-theory}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vkA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{V-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vkA}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Soundness}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\<%
\end{code}
Next we prove an important property of the relatively free algebra (relative to \ab{ùí¶} and satisfying the identities in \af{Th} \ab{ùí¶}), which will be used in the formalization of the HSP theorem; this is the assertion that for every algebra ùë®, if \ab{ùë®} \af{‚ä®} \ab{Th} (\af{V} \ab{ùí¶}), then there exists an epimorphism from \Free{A} onto \ab{ùë®}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}%
\>[10]\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeHom}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{renaming}%
\>[72]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaField{Carrier}%
\>[83]\AgdaSymbol{to}\AgdaSpace{}%
\AgdaField{A}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{isEpi}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚ü®\$‚ü©\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{id}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pq}%
\>[21]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}%
\>[30]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[21]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}%
\>[30]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{kernel-in-theory}\AgdaSpace{}%
\AgdaBound{pq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[30][@{}l@{\AgdaIndent{0}}]%
\>[31]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{isEpi}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsEpi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{œÜ}\<%
\\
%
\>[2]\AgdaField{compatible}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isHom}\AgdaSpace{}%
\AgdaFunction{isEpi}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Interp}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚â°.refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaFunction{isEpi}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{eq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{‚Ñä}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{refl}\<%
\end{code}
\ifshort\else

\medskip

\noindent Actually, we will need the following lifted version of this result.

\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi-lift}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaFunction{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{F-ModTh-epi-lift}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚àò-epi}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{F-ModTh-epi}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A‚ààModThK}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaFunction{ToLift-epi}\<%
\end{code}
\fi


%% -------------------------------------------------------------------------------------

\section{Birkhoff's Variety Theorem}

\subsection{Informal statement and proof}
Let \ab{ùí¶} be a class of algebras. Recall that \ab{ùí¶} is a \emph{variety} provided it is closed under homomorphisms, subalgebras and products; equivalently, \af{H} (\af{S} (\af{P} \ab{ùí¶})) ‚äÜ \ab{ùí¶}.
(As \af{H}, \af{S}, and \af{P} are closure operators, the inclusion \ab{ùí¶} ‚äÜ \af{H} (\af{S} (\af{P} \ab{ùí¶}))
is always valid, for every class \ab{ùí¶}.)
We call \ab{ùí¶} an \emph{equational class} if it is precisely the class of all models of some set of term identities.

It is easy to prove that \emph{every equational class is a variety}.  Indeed, suppose \ab{ùí¶} is an equational
class and suppose the set \ab{‚Ñ∞} of term identities \defn{axiomatizes} \ab{ùí¶}. That is, \ab{ùí¶} \af{‚ä´} \ab{‚Ñ∞} and for all \ab{ùë®} we have \ab{ùë®} \af{‚ä®} \ab{‚Ñ∞} \as{‚Üí} \ab{ùë®} \af{‚àà} \ab{ùí¶}. Then, since the classes \af H \ab{ùí¶}, \af S \ab{ùí¶}, \af P \ab{ùí¶} and \ab{ùí¶} all satisfy the same set of equations, we have \af{H} (\af{S} (\af{P} \ab{ùí¶})) ‚ä´ \ab{‚Ñ∞}, so \af{V} \ab{ùí¶} = \af{H} (\af{S} (\af{P} \ab{ùí¶})) ‚äÜ \ab{ùí¶}; that is, \ab{ùí¶} is a variety. The converse assertion---that \emph{every variety is an equational class}---is more difficult to prove and is known as Birkhoff's variety theorem.

We now describe the standard informal proof of Birkhoff's theorem and then present a formal, constructive, type-theoretic proof of this theorem in Agda.

Let \ab{ùí¶} be an arbitrary variety.  We will describe a set of equations that axiomatizes \ab{ùí¶}, thus showing that \ab{ùí¶} is an equational class.  A natural choice is the set \af{Th} \ab{ùí¶} of all equations that hold in \ab{ùí¶}. We will prove that \ab{ùí¶} is precisely the class of structures
modeling \af{Th} \ab{ùí¶}
.
Define \ab{ùí¶‚Å∫} = \af{Mod} (\af{Th} \ab{ùí¶}).  Clearly, \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶‚Å∫}. We prove the reverse inclusion. Let \ab{ùë®} \af{‚àà} \ab{ùí¶‚Å∫}.
To complete the proof it suffices to find an algebra \ab{ùë≠} belonging to \af{S} (\af{P} \ab{ùí¶}) such that
\ab{ùë®} is the homomorphic image of \ab{ùë≠}. Indeed, this will prove that \ab{ùë®} belongs to
\af{H} (\af{S} (\af{P} \ab{ùí¶})), which is \ab{ùí¶}, since we assumed that \ab{ùí¶} is a variety.

Let \ab{X} be a set of cardinality max(|A|, œâ), and let \ab{œÅ} : \ab{X} \as{‚Üí} \af{ùïå[ \ab{ùë®} ]} be a surjective valuation of variable symbols in the domain of \ab{ùë®}. By the \af{lift-hom} lemma that we formalized above, there is an epimorphism \ab{h} from \T{X} onto \ab{ùïå[ \ab{ùë®} ]} that \emph{extends} \ab{œÅ} (that is, \ab{h} \ab x ‚âà \ab{œÅ} \ab x for all \ab x : \ab X).
Now, put \aof{ùîΩ[ \ab{X} ]}~:=~\T{X}/\ab{Œò}, and let \ab{g} : \T{X} \as{‚Üí} \aof{ùîΩ[ \ab{X} ]} be the natural epimorphism with kernel \ab{Œò}. We claim that \af{ker} \ab g \af{‚äÜ} \af{ker} \ab h. If the claim is true, then there is a map \ab{f} : \ab{ùîΩ} \as{‚Üí} \ab{ùë®} such that \ab f \af{‚àò} \ab g = \ab h.
Since \ab h is epic, so is \ab f. Hence \ab{ùë®} \af{‚àà} \af{ùñß} (\af{ùîΩ} \ab X) \aof{‚äÜ} \ab{ùí¶‚Å∫} completing the proof.


\subsection{Formal statement and proof}

We now show how to formally express and prove the twin assertions that
(i) every equational class is a variety and (ii) every variety is an equational class.

\paragraph*{Every equational class is a variety}
For (i), we need an arbitrary equational class. To obtain one, we start with an arbitrary
collection \ab{‚Ñ∞} of equations and let \ab{ùí¶} = \af{Mod} \ab{‚Ñ∞}, the equational class
determined by \ab{‚Ñ∞}. We prove that \ab{ùí¶} is a variety by showing that
\ab{ùí¶} = \af{V} \ab{ùí¶}. The inclusion \ab{ùí¶} \aof{‚äÜ} \af V \ab{ùí¶}, which holds for all
classes \ab{ùí¶}, is called the \defn{expansive} property of \af{V}. The converse inclusion
\af V \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}, on the other hand, requires the hypothesis that \ab{ùí¶} is an
equation class. We now formalize each of these inclusions.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{))\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{V-expa}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[1]\AgdaFunction{V-expa}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSymbol{(}\AgdaFunction{‚ä§}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{Goal}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚â§-reflexive}\AgdaSymbol{)}\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{IdHomImage}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{()}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaFunction{refl‚®Ö}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{xy}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚ü∂}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaFunction{tt}\<%
\\
%
\>[2]\AgdaField{cong}\AgdaSpace{}%
\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{xy}\AgdaSpace{}%
\AgdaFunction{tt}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaRecord{‚âÖ}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkiso}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{to‚®Ö}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{refl‚®Ö}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{from‚®Ö}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{mkhom}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{refl}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
Earlier we proved the identity preservation lemma,
\af{V-id1} : \ab{ùí¶} \aof{‚ä´} \ab p \aof{‚âà} \ab q \as{‚Üí} \af{V} \ab{‚Ñì} \ab{Œπ} \ab{ùí¶} \aof{‚ä´} \ab p \aof{‚âà} \ab q.
Thus, if \ab{ùí¶} is an equational class, then \af V \ab{ùí¶} \aof{‚äÜ} \ab{ùí¶}, as we now confirm.

\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaBound{‚Ñ∞}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{‚Ñì}\<%
\\
%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSymbol{\{}\AgdaArgument{Œ±}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñ∞}%
\>[36]\AgdaComment{--\ an\ arbitrary\ equational\ class}\<%
\\
%
\>[1]\AgdaFunction{EqCl‚áíVar}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{ùí¶}\<%
\\
%
\>[1]\AgdaFunction{EqCl‚áíVar}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaBound{vA}\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{p‚Ñ∞q}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{V-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaArgument{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùí¶}\AgdaSymbol{\}\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}(Œª}\AgdaSpace{}%
\AgdaBound{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{p‚Ñ∞q}\AgdaSpace{}%
\AgdaBound{œÑ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}
Together, \af{V-expa} and \af{Eqcl‚áíVar} prove that every equational class is a variety.


\paragraph*{Every variety is an equational class}
To prove statement (ii), we need an arbitrary variety; to obtain one, we start with an arbitrary class
\ab{ùí¶} of \ab{ùëÜ}-algebras and take its \emph{varietal closure}, \af{V} \ab{ùí¶}.
We prove that \af{V} \ab{ùí¶} is an equational class by showing it is precisely the collection of
algebras that model the equations in \af{Th} (\af{V} \ab{ùí¶}); that is, we prove
\af{V} \ab{ùí¶} = \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})).
The inclusion \af{V} \ab{ùí¶} \aof{‚äÜ} \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})) is a simple consequence of the fact that \af{Mod} \af{Th} is a closure operator. Nonetheless, completeness demands
that we formalize this fact, however trivial is its proof.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{))\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{ModTh-closure}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaGeneralizable{Œ≤}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µá}\AgdaSymbol{\}\{}\AgdaGeneralizable{Œ≥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·∂ú}\AgdaSymbol{\}\{}\AgdaGeneralizable{Œ¥}\AgdaSymbol{\}\{}\AgdaGeneralizable{œÅ·µà}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSymbol{\{}\AgdaArgument{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\<%
\\
%
\>[1]\AgdaFunction{ModTh-closure}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{vA}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
\>[0]\<%
\end{code}

It remains to prove the converse inclusion, \af{Mod} (\af{Th} (V ùí¶)) \aof{‚äÜ} \af{V} \ab{ùí¶},
which is the main focus of the rest of the paper.  We proceed as follows:

\begin{enumerate}
\item \label{item:1} Let \ab{ùë™} be the product of all algebras in \af{S} \ab{ùí¶}, so that \ab{ùë™} \af{‚àà} \af{P} (\af{S} \ab{ùí¶}).
\item Prove \af{P} (\af{S} \ab{ùí¶}) \af{‚äÜ} \af{S} (\af{P} \ab{ùí¶}), so \ab{ùë™} \af{‚àà} \af{S} (\af{P} \ab{ùí¶}) by item~\ref{item:1}.
\item Prove \aof{ùîΩ[ \ab{X} ]} \af{‚â§} \ab{ùë™}, so that \aof{ùîΩ[ \ab{X} ]} \af{‚àà} \af{S} (\af{S} (\af{P} \ab{ùí¶})) (= \af{S} (\af{P} \ab{ùí¶})).
\item Prove that every algebra in \af{Mod} (\af{Th} (V ùí¶)) is a homomorphic image of
\aof{ùîΩ[ \ab{X} ]} and thus belongs to \af{H} (\af{S} (\af{P} \ab{ùí¶})) (= \af{V} \ab{ùí¶}).
\end{enumerate}

To define \ab{ùë™} as the product of all algebras in \af{S} \ab{ùí¶}, we must first indexing the class \af{S} \ab{ùí¶}.
In fact, we will need to associate each ``indexing pair'' (\ab{ùë®} , \ab p) (where \ab p : \ab{ùë®} \af{‚àà} \af{S} \ab{ùí¶}) with an arbitrary environment
\ab{œÅ} : \ab X \as{‚Üí} \aof{ùïå[ \ab{ùë®} ]}. Consequently, the indices of the product will be triples (\ab{ùë®} , \ab p, \ab{œÅ}) ranging over all algebras in \af{S} \ab{ùí¶} and all
environments assigning values in the domain of \ab{ùë®} to variables in \ab X.  Here is the construction of \ab{ùë™}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeHom}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSymbol{\}}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}%
\>[33]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Env}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{‚Ñë‚Å∫}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaFunction{Œπ}\<%
\\
%
\>[1]\AgdaFunction{‚Ñë‚Å∫}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£[}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{‚àà}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{Carrier}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Env}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñë‚Å∫}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[1]\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\<%
\\
%
\>[1]\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{ùîÑ‚Å∫}\<%
\end{code}

\ifshort\else
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñë‚Å∫}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[1]\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
The type \af{skEqual} provides a term identity \ab p \af{‚âà} \ab q for each index \ab i = (\ab{ùë®} , \ab{p} , \ab{œÅ}) of the product.
%(here, as above, \ab{ùë®} is an algebra, \ab{sA} is a proof that \ab{ùë®} belongs to \af{S} \ab{ùí¶}, and \ab{œÅ} is an environment).
%map assigning values in the domain of \ab{ùë®} to variable symbols in \ab X).
Later we prove that if the identity \ab{p} \af{‚âà} \ab q holds in all \ab{ùë®} \aof{‚àà} \af S \ab{ùí¶} (for all environments), then \ab p \af{‚âà} \ab q
holds in the relatively free algebra \Free{X}; equivalently, the pair (\ab p , \ab q) belongs to the
kernel of the natural homomorphism from \T{X} onto \Free{X}. We will use that fact to prove
that the kernel of the natural hom from \T{X} to \ab{ùë™} is contained in the kernel of the natural hom from \T{X} onto \Free{X},
whence we construct a monomorphism from \Free{X} into \ab{ùë™}, and thus \Free{X} is a subalgebra of \ab{ùë™},
so belongs to \af S (\af P \ab{ùí¶}).
\fi

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{homC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{homC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö-hom-co}\AgdaSpace{}%
\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaFunction{h}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{h}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\<%
\end{code}
\ifshort\else
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{kerF‚äÜkerC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{kerF‚äÜkerC}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Goal}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[22]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{fl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaFunction{free-lift}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\>[2]\AgdaFunction{fl}\AgdaSpace{}%
\AgdaBound{t}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{free-lift-interp}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{t}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ä¢}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚ñπ}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sound}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{kA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Soundness}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{subgoal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
%
\>[2]\AgdaFunction{subgoal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S-id1}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Œ∂}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{œÅ}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fl}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{subgoal}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fl}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{))}\<%
\end{code}
\fi
\begin{code}%
%
\>[1]\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{HomFactor}\AgdaSpace{}%
\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaFunction{homC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{kerF‚äÜkerC}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{isSurjective}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{epiF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
\>[0]\<%
\end{code}
If \AgdaPair{p}{q} belongs to the kernel of \af{homùë™}, then
\af{Th} \ab{ùí¶} includes the identity \ab{p} \af{‚âà} \ab{q}---that is,
\af{Th} \ab{ùí¶} \af{‚ä¢} \ab X \af{‚ñπ} \ab{p} \af{‚âà} \ab{q}. Equivalently,
if the kernel of \af{homùë™} is contained in that of \af{homùîΩ[ X ]}.
\ifshort
We omit the formal proof of this lemma and merely display its formal statement, which is the following.
\else
We formalize this fact as follows.
\fi

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{kerC‚äÜkerF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\end{code}
\ifshort\else
\begin{code}%
%
\>[1]\AgdaFunction{kerC‚äÜkerF}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{pKq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Sùí¶‚ä´‚ÜíkerùîΩ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Sùí¶‚ä´}\AgdaSpace{}%
\AgdaFunction{pqEqual}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{œÅ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´‚ÜíkerùîΩ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ä´}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ker}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{homF[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{Sùí¶‚ä´‚ÜíkerùîΩ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{hyp}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S-id2}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{pqEqual}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{skEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaFunction{pqEqual}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{goal}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaKeyword{where}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Environment}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}%
\>[28]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{Setoid}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîª[}}\AgdaSpace{}%
\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[28]\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaField{\AgdaUnderscore{}‚âà\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\\
%
\>[3]\AgdaFunction{goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âà}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaOperator{\AgdaField{‚ü®\$‚ü©}}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[3]\AgdaFunction{goal}%
\>[9]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{\}(}\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\<%
\\
%
\>[9]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{pKq}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)(}\AgdaFunction{sym}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{free-lift-interp}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)))}\<%
\\
\>[0]\<%
\end{code}
\fi
We conclude that the homomorphism from \Free{X} to \af{ùë™} is injective, whence it follows that \Free{X} is (isomorphic to) a subalgebra of \af{ùë™}.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{monFC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{mon}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{monFC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{isMon}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{isMon}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsMon}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaField{isHom}\AgdaSpace{}%
\AgdaFunction{isMon}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{homFC}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaField{isInjective}\AgdaSpace{}%
\AgdaFunction{isMon}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{œÜpq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{kerC‚äÜkerF}\AgdaSpace{}%
\AgdaBound{œÜpq}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{F‚â§C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{ùë™}\<%
\\
%
\>[1]\AgdaFunction{F‚â§C}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mon‚Üí‚â§}\AgdaSpace{}%
\AgdaFunction{monFC}\<%
\\
\>[0]\<%
\end{code}
Using the last result we prove that \Free{X} belongs to \af{S} (\af{P} \ab{ùí¶}). This requires one more technical lemma concerning the classes \af{S} and \af{P};
specifically,
\ifshort
\af{P} (\af{S} \ab{ùí¶}) \aof{‚äÜ} \af{S} (\af{P} \ab{ùí¶}) holds for every class \ab{ùí¶}.
The \ualmodule{Varieties.Func.Preservation.lagda} module contains the formal statement and proof of that result (called \af{PS‚äÜSP}) which we omit.
\else
a product of subalgebras of algebras in a class is a subalgebra of a product of algebras in the class;
in other terms, \af{P} (\af{S} \ab{ùí¶}) \aof{‚äÜ} \af{S} (\af{P} \ab{ùí¶}), for every class \ab{ùí¶}.
We state and prove this in Agda as follows.

\begin{code}%
\>[0]\<%
\\
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{a}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{PS‚äÜSP}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{a}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSymbol{\}\{}\AgdaBound{œÅ·µÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{PS‚äÜSP}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë©}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{B‚âÖ‚®ÖA}\AgdaSpace{}%
\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Goal}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\<%
\\
%
\>[2]\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[2]\AgdaFunction{kB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[2]\AgdaFunction{kB}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[10]\AgdaField{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaFunction{‚®ÖA‚â§‚®ÖB}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{‚Ñ¨}\<%
\\
%
\>[2]\AgdaFunction{‚®ÖA‚â§‚®ÖB}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö-‚â§}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{snd}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{sA}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}\{}\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}}\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{Œ≤}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}\{}\AgdaFunction{oa‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{oa‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Goal}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚Ñ¨}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{kB}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚âÖ-refl}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚âÖ-trans-‚â§}\AgdaSpace{}%
\AgdaBound{B‚âÖ‚®ÖA}\AgdaSpace{}%
\AgdaFunction{‚®ÖA‚â§‚®ÖB}\AgdaSymbol{)}\<%
\end{code}
\fi

%We conclude this subsection with the proof that \Free{X} belongs to \af{S} (\af{P} \ab{ùí¶}).

\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{SPF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{SPF}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S-idem}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{spC}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{F‚â§C}\AgdaSymbol{))}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{psC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{P}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{psC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚Ñë‚Å∫}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑ‚Å∫}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{((Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaField{fst}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{‚âÖ-refl}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaFunction{spC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ùë™}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{spC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{PS‚äÜSP}\AgdaSpace{}%
\AgdaFunction{psC}\<%
\\
\>[0]\<%
\end{code}
Finally, we prove that every algebra in \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})) is a homomorphic image of \af{ùîΩ[ \ab{X} ]}, for some \ab{X}.

\ifshort\else
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSymbol{(}\AgdaRecord{Algebra}\AgdaSpace{}%
\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaGeneralizable{‚Ñì}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{private}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Œ±}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{œÅ·µÉ}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ov}\AgdaSpace{}%
\AgdaFunction{c}\<%
\\
%
\>[1]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{FreeAlgebra}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{œá}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{c}\AgdaSymbol{\}(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
\fi
\begin{code}%
\>[0]\<%
\\
%
\>[1]\AgdaFunction{Var‚áíEqCl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Mod}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Th}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{V}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[1]\AgdaFunction{Var‚áíEqCl}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{ModThA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{spFA}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{AimgF}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{spFA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{S}\AgdaSymbol{\{}\AgdaFunction{Œπ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{P}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{spFA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SPF}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%
\\
%
\>[2]\AgdaFunction{epiFlA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{epi}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{epiFlA}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{F-ModTh-epi-lift}\AgdaSymbol{\{}\AgdaArgument{‚Ñì}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{‚Ñì}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ModThA}\AgdaSymbol{\{}\AgdaArgument{p}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{\}\{}\AgdaBound{q}\AgdaSymbol{\})}\<%
\\
%
\>[2]\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{epi‚Üíontohom}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-Alg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSpace{}%
\AgdaFunction{Œπ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{epiFlA}\<%
\\
%
\>[2]\AgdaFunction{AimgF}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsHomImageOf}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùîΩ[}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ùïå[}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\>[2]\AgdaFunction{AimgF}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[7323I]\AgdaFunction{‚àò-hom}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{from}\AgdaSpace{}%
\AgdaFunction{Lift-‚âÖ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\<%
\\
\>[.][@{}l@{}]\<[7323I]%
\>[10]\AgdaFunction{‚àò-IsSurjective}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{œÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fromIsSurjective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lift-‚âÖ}\AgdaSymbol{\{}\AgdaArgument{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{\}))}\<%
\\
\>[0]\<%
\end{code}

It follows immediately from \af{ModTh-closure} and \af{Var‚áíEqCl} that
\af{V} \ab{ùí¶} = \af{Mod} (\af{Th} (\af{V} \ab{ùí¶})) holds for every class \ab{ùí¶} of \ab{ùëÜ}-algebras.
Thus, every variety is an equational class. This completes the formal proof of Birkhoff's variety theorem.

%% -----------------------------------------------------------------------------
\section{Related work}
There have been a number of efforts to formalize parts of universal algebra in
type theory besides ours, most notably

\begin{enumerate}
\item
In~\cite{Capretta:1999}, Capretta formalized the basics of universal algebra in the
   Calculus of Inductive Constructions using the Coq proof assistant;
\item In~\cite{Spitters:2011}, Spitters and van der Weegen formalized the basics of universal algebra
   and some classical algebraic structures, also in the Calculus of Inductive Constructions using
   the Coq proof assistant and promoting the use of type classes;
\item In~\cite{Gunther:2018} Gunther et al developed what seemed (prior to the \agdaalgebras library) to be
   the most extensive library of formalized universal algebra to date; like \agdaalgebras, that work is based on dependent type theory, is programmed in Agda, and goes beyond the Noether isomorphism theorems to include some basic equational logic; although the coverage is less extensive than that of \agdaalgebras, Gunther et al do treat \emph{multisorted} algebras, whereas \agdaalgebras is currently limited to single sorted structures.
   \item In~\cite{Amato:2021}, ``Amato et al formalize multi-sorted algebras with finitary operators in UniMath. Limiting to finitary operators is due to the restrictions of the UniMath type theory, which does not have W-types nor user-defined inductive types. These restrictions also prompt the authors to code terms as lists of stack machine instructions rather than trees'' (quoting~\cite{Abel:2021}).
\item In~\cite{Lynge:2019}, ``Lynge and Spitters formalize multi-sorted algebras in HoTT, also restricting to finitary operators. Using HoTT they can define quotients as types, obsoleting setoids. They prove three isomorphism theorems concerning sub- and quotient algebras. A universal algebra or varieties are not formalized'' (quoting~\cite{Abel:2021}).
\item In~\cite{Abel:2021}, Abel gives a new formal proof of the soundness theorem and Birkhoff's completeness theorem for multi-sorted algebraic structures.
\end{enumerate}

%Some other projects aimed at formalizing mathematics generally, and algebra in particular, have developed into very extensive libraries that include definitions, theorems, and proofs about algebraic structures, such as groups, rings, modules, etc.  However, the goals of these efforts seem to be the formalization of special classical algebraic structures, as opposed to the general theory of (universal) algebras. Moreover, the part of universal algebra and equational logic formalized in the \agdaalgebras library extends beyond the scope of prior efforts.

%Prior to our work, a constructive version of Birkhoff's theorem was published by Carlstr\"om in~\cite{Carlstrom:2008}.  However, the logical foundations of that work is constructive set theory and, as far as we know, there was no attempt to formalized it in type theory and verify it with a proof assistant.


\paragraph*{Acknowledgments}
This work would not have been possible without the wonderful \agda language, which is developed and maintained by The Agda Team (Andreas Abel, Guillaume Allais, Liang-Ting Chen, Jesper Cockx, Nils Anders Danielsson, V√≠ctor L√≥pez Juan, Ulf Norell, Andr√©s Sicard-Ram√≠rez,Andrea Vezzosi, and Tesla Ice Zhang), and the \agdastdlib, maintained by Matthew Daggitt and Guillaume Allais.
The manuscript was generated from the literate \agda file \HSPlagda and the \LaTeX2e file \agdahsp (processed with the commands
\texttt{agda --latex} and \texttt{pdflatex}, respectively), which are available in the \agdaalgebras GitHub repository ({\small \url{https://github.com/ualib/agda-algebras}}).
