\documentclass[a4paper,UKenglish,cleveref,autoref,thm-restate]{lipics-v2021}
%% The next 3 lines are recommended at: https://agda.readthedocs.io/en/v2.6.1.1/tools/generating-latex.html#known-pitfalls-and-issues
\usepackage{fontspec}
%% \defaultfontfeatures[\rmfamily]{}
%% \setmainfont{Latin Modern Roman}%% \usepackage{mathabx}

\crefformat{footnote}{#2\footnotemark[#1]#3}

\usepackage{proof-dashed}
\usepackage{comment}

\usepackage[wjdsimple,links]{agda}
%\usepackage[newwjd,links]{agda}
%\usepackage[bw,links]{agda}
\usepackage{wjd}
\usepackage{unixode}

%This is a template for producing LIPIcs articles. 
%See lipics-v2021-authors-guidelines.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling autoref support, use "autoref"
%for anonymousing the authors (e.g. for double-blind review), add "anonymous"
%for enabling thm-restate support, use "thm-restate"
%for enabling a two-column layout for the author/affilation part (only applicable for > 6 authors), use "authorcolumns"
%for producing a PDF according the PDF/A standard, add "pdfa"
%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory
%% \pdfmapfile{+fontawesome5.map}
\bibliographystyle{plainurl}% the mandatory bibstyle

\title{The Agda Universal Algebra Library and\\ Birkhoff's Theorem in Dependent Type Theory}

\titlerunning{The Agda Universal Algebra Library}

\author{William DeMeo}
       {Department of Algebra, Charles University in Prague \and \url{https://williamdemeo.gitlab.io}}
       {williamdemeo@gmail.com}
       {https://orcid.org/0000-0003-1832-5690}
       {}

\authorrunning{W.~J.~DeMeo}


%% \usepackage{fancyhdr}
%% \fancyfoot{}
%% \pagestyle{fancy}
%% \fancyhf{}
%% \fancyhead[ER]{\sffamily\bfseries \leftmark}
%% \fancyhead[OL]{\sffamily\bfseries The Agda Universal Algebra Library}
%% \fancyhead[EL,OR]{\sffamily\bfseries \thepage}
%% \renewcommand{\headrulewidth}{0pt}

\Copyright{William J. DeMeo}

\ccsdesc[500]{Theory of computation~Constructive mathematics}
\ccsdesc[500]{Theory of computation~Type theory}
\ccsdesc[500]{Theory of computation~Logic and verification}
\ccsdesc[300]{Computing methodologies~Representation of mathematical objects}
\ccsdesc[300]{Theory of computation~Type structures}


\keywords{Universal algebra, Equational logic, Martin-L√∂f Type Theory, Birkhoff‚Äôs HSP Theorem, Formalization of mathematics, Agda, Proof assistant}

\category{} %optional, e.g. invited paper

\relatedversion{hosted on arXiv}
\relatedversiondetails[linktext={arxiv.org/pdf/2101.10166}]{Extended Version}{https://arxiv.org/pdf/2101.10166}

\supplement{~\\ \textit{Documentation}: \ualibdotorg}%
\supplementdetails{Software}{https://gitlab.com/ualib/ualib.gitlab.io.git}

\acknowledgements{The author wishes to thank Hyeyoung Shin and Siva Somayyajula for their contributions to this project and \MartinEscardo for creating the \TypeTopology library and teaching a course on \href{https://www.cs.bham.ac.uk/~mhe/HoTT-UF-in-Agda-Lecture-Notes/index.html}{Univalent Foundations of Mathematics with Agda} at the \href{http://events.cs.bham.ac.uk/mgs2019/}{2019 Midlands Graduate School in Computing Science}. Of course, this work would not exist in its current form without the Agda 2 language by Ulf Norell.\footnote{Agda 2 is partially based on code from Agda 1 by Catarina Coquand and Makoto Takeyama, and from Agdalight by Ulf Norell and Andreas Abel.}}

%\nolinenumbers %uncomment to disable line numbering

%\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{}
\EventNoEds{2}
\EventLongTitle{}
\EventShortTitle{}
\EventAcronym{}
\EventYear{2021}
\EventDate{January 19, 2021}
\EventLocation{}
\EventLogo{}
\SeriesVolume{0}
\ArticleNo{0}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle


\begin{abstract}
The Agda Universal Algebra Library (\ualib) is a library of types and programs (theorems and proofs) we developed to formalize the foundations of universal algebra in Martin-LoÃàf-style dependent type theory using the \agda programming language and proof assistant. This paper describes the \ualib and demonstrates that Agda is accessible to working mathematicians (such as ourselves) as a tool for formally verifying nontrivial results in general algebra and related fields. The library includes a substantial collection of definitions, theorems, and proofs from universal algebra and equational logic and as such provides many examples that exhibit the power of inductive and dependent types for representing and reasoning about general algebraic and relational structures.

The first major milestone of the \ualib project is a complete proof of Birkhoff's HSP theorem. To the best of our knowledge, this is the first time Birkhoff's theorem has been formulated and proved in dependent type theory and verified with a proof assistant.

In this paper we describe the \agdaualib and the formal proof of Birkhoff's theorem, discussing some of the technically challenging parts of the proof. In so doing, we illustrate the effectiveness of dependent type theory, Agda, and the \ualib for formally verifying nontrivial theorems in universal algebra and equational logic.
\end{abstract}



\section{Introduction}\label{sec:introduction}
To support formalization in type theory of research level mathematics in universal algebra and related fields, we present the Agda Universal Algebra Library (\agdaualib), a software library containing formal statements and proofs of the core definitions and results of universal algebra. 
The \agdaualib is written in \agda~\cite{Norell:2009}, a programming language and proof assistant based on Martin-L\"of Type Theory that not only supports dependent and inductive types, but also provides powerful \emph{proof tactics} for proving things about the objects that inhabit these types.

There have been a number of prior efforts to formalize parts of universal algebra in type theory, most notably
\begin{itemize}
  \item Capretta~\cite{Capretta:1999} (1999) formalized the basics of universal algebra in the Calculus of Inductive Constructions using the Coq proof assistant;
    \item Spitters and van der Weegen~\cite{Spitters:2011} (2011) formalized the basics of universal algebra and some classical algebraic structures, also in the Calculus of Inductive Constructions using the Coq proof assistant, promoting the use of type classes as a preferable alternative to setoids;
 \item Gunther, et al~\cite{Gunther:2018} (2018) developed what seems to be (prior to the \ualib) the most extensive library of formal universal algebra to date; in particular, this work includes a formalization of some basic equational logic; the project (like the \ualib) uses Martin-L\"of Type Theory and the Agda proof assistant.
\end{itemize}
Some other projects aimed at formalizing mathematics generally, and algebra in particular, have developed into very extensive libraries that include definitions, theorems, and proofs about algebraic structures, such as groups, rings, modules, etc.  However, goals of this prior work seem to be the formalization of special classical algebraic structures, as opposed to the general theory of (universal) algebras.

Although the \agdaualib project was initiated relatively recently (in 2018), the part of universal algebra and equational logic that it formalizes extends beyond the scope of prior efforts.  In particular, the \ualib now includes the only formal, constructive, machine-checked proof of Birkhoff's variety theorem that we know of. We remark that, with the exception of~\cite{Carlstrom:2008}, all other proofs of Birkhoff's theorem we have seen are informal and not known to be constructive.

%% \subsection{Vision and Goals}\label{vision-and-goals}
The seminal idea for the \agdaualib project was the observation that, on the one hand, a number of fundamental constructions in universal algebra can be defined recursively, and theorems about them proved by structural induction, while, on the other hand, inductive and dependent types make possible very precise formal representations of recursively defined objects, which often admit elegant constructive proofs of properties of such objects.  An important feature of such proofs in type theory is that they are total functional programs and, as such, they are computable and composable.
%% These observations suggested that there would be much to gain from implementing universal algebra in a language, such as Martin-L\"of type theory, that features dependent and inductive types.

Finally, our own research experience has taught us that a proof assistant and programming language (like Agda), when equipped with specialized libraries and domain-specific tactics to automate proof idioms of a particular field, can be an extremely powerful and effective asset. We believe that such libraries, and the proof assistants they support, will eventually become indispensable tools in the working mathematician's toolkit.



\subsection{Contributions and organization}
\label{sec:contributions}
Apart from the library itself, we describes the formal implementation and proof of a deep result, Garrett Birkhoff's celebrated HSP theorem~\cite{Birkhoff:1935}, which was among the first major results of universal algebra.  The theorem states that a \defn{variety} (a class of algebras closed under quotients, subalgebras, and products) is an equational class (defined by the set of identities satisfied by all its members).  %% More precisely, a class ùí¶ of algebras is closed under the taking of quotients, subalgebras, and arbitrary products if and only if ùí¶ is the class of algebras satisfying a certain set of equations.
The fact that we now have a formal proof of this is noteworthy, not only because this is the first time the theorem has been proved in dependent type theory and verified with a proof assistant, but also because the proof is constructive. As the paper~\cite{Carlstrom:2008} of Carlstr\"om makes clear, it is a highly nontrivial exercise to take a well-known informal proof of a theorem like Birkhoff's and show that it can be formalized using only constructive logic and natural deduction, without appealing to, say, the Law of the Excluded Middle or the Axiom of Choice.

Each of the sections that follow describes the most important or noteworthy components of the \ualib. We cover just enough to keep the paper somewhat self-contained.  Of course, space does not permit us to cover every definition and theorem required to present a complete formal proof of a theorem like Birkhoff's.  We remedy this in two ways. First, throughout the paper we include pointers to places in the documentation where the omitted material can be found.  Second, we include an appendix containing \agda background, discussion of the foundational assumptions of the \ualib, and definitions of some important types of dependent type theory and how they are represented in \agda and in the \ualib.  We hope this appendix is especially useful to readers who are not already proficient users of \agda.



Finally, the official sources of information about the \agdaualib are
\begin{itemize}
  \item \href{https://ualib.gitlab.io}{\texttt{ualib.org}} (the web site) includes every line of code in the library, rendered as html and accompanied by documentation, and
  \item \href{https://gitlab.com/ualib/ualib.gitlab.io}{\texttt{gitlab.com/ualib/ualib.gitlab.io}} (the source code) freely available and licensed under the \href{https://creativecommons.org/licenses/by-sa/4.0/}{Creative Commons Attribution-ShareAlike 4.0 International License}.
\end{itemize}

















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Algebras %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Algebras}\label{sec:types-for-algebras}

We define the type of \defn{operations} and, as an example, the type of \defn{projections}.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[0]\AgdaFunction{Op}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\\
\>[1]\AgdaFunction{œÄ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Op}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaFunction{œÄ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\<%
\end{code}
\ccpad
The type \AgdaFunction{Op} encodes the arity of an operation as an arbitrary type \ab I : \ab ùì• Ãá, which gives us a very general way to represent an operation as a function type with domain \ab I ‚Üí \ab A (the type of ``tuples'') and codomain \ab A. The last two lines of the code block above codify the \ab i-th \ab I-ary projection operation on \ab A.

\subsection{Signature type}\label{signature-type}
We define the signature of an algebraic structure in Agda like this.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚Å∫}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
\>[0]\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{F}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{F}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Here \AgdaBound{ùìû} is the universe level of operation symbol types, while \AgdaBound{ùì•} is the universe level of arity types. We denote the first and second projections by \ai ‚à£ and \ai ‚à• (\S\ref{ssec:dependent-pairs-and-projections}) so if \ab ùëÜ is a signature, then \aiab{‚à£}{ùëÜ} denotes the type of \defn{operation symbols}, and \aiab{‚à•}{ùëÜ} denotes the \defn{arity} function. If \ab ùëì~\as :~\af ‚à£~\ab ùëÜ~\af ‚à£ is an operation symbol in the signature \ab ùëÜ, then \aiab{‚à•}{ùëÜ} \ab ùëì is the arity of \ab ùëì. For example, %% \subsubsection{Example}\label{Signatures.sssec:example}
here is the signature of \emph{monoids}, as a member of the type \AgdaFunction{Signature} \AgdaBound{ùìû} \AgdaBound{ùì§‚ÇÄ}.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{e}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\<%
\\
%
\>[2]\AgdaInductiveConstructor{¬∑}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{monoid-sig}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaBound{ùì§‚ÇÄ}\<%
\\
%
\>[1]\AgdaFunction{monoid-sig}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{monoid-op}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{e}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ùüò}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{¬∑}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ùüö}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\ccpad
This signature has two operation symbols, \aic e and \aic ¬∑, and a function \as Œª \as{\{} \AgdaInductiveConstructor{e} \as ‚Üí \af ùüò \as ; \AgdaInductiveConstructor{¬∑} \as ‚Üí \af ùüö \as{\}} which maps \aic e to the empty type \af ùüò (since \aic e is nullary), and \aic ¬∑ to the 2-element type \af ùüö (since \aic ¬∑ is binary).








\newcommand\sigOV{\AgdaFunction{Signature}\AgdaSpace{}\AgdaBound{ùìû}\AgdaSpace{}\AgdaBound{ùì•}\xspace}
\subsection{Algebra type}\label{ssec:algebra-type}
For a fixed signature \ab S \as : \sigOV and universe \ab ùì§, we define the type of \defn{algebras} in the signature \ab ùëÜ (or \ab ùëÜ-\defn{algebras}) and with \defn{domain} (or \defn{carrier}) \ab ùê¥ \as : \ab ùì§ \as Ãá as follows\footnote{The \agdaualib includes an alternative definition of the type of algebras using records, but we don't discuss these here since they are not needed in the sequel. We refer the interested reader to~\cite{DeMeo:2021} and the html documentation available at \url{https://ualib.gitlab.io/UALib.Algebras.Algebras.html}.}
\ccpad
\begin{code}%
\>[0]\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{)(}\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Signature}\AgdaSpace{}%
\AgdaGeneralizable{ùìû}\AgdaSpace{}%
\AgdaGeneralizable{ùì•}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[50]\AgdaGeneralizable{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaGeneralizable{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚Å∫}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}%
\>[13]\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Op}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\end{code}
\ccpad
We may refer to an inhabitant of \af{Algebra} \ab ùëÜ \AgdaBound{ùì§} as an ``‚àû-algebra'' because its domain can be an arbitrary type, say, \ab A \as : \ab ùì§ \af Ãá and need not be truncated at some level (\S\ref{ssec:truncation-and-sets}). In particular, \ab A need not be a set (as defined in \S\ref{ssec:truncation-and-sets}).\footnote{We could pause here to define the type of ``0-algebras,'' which are algebras whose domains are sets. This type is probably closer to what most of us think of when doing informal universal algebra. However, in the \ualib we have so far only needed to know that the domain of an algebra is a set in a handful of specific instances, so it seems preferable to work with general (‚àû-)algebras throughout the library and then assume \emph{uniquness of identity proofs} explicitly where, and only where, a proof relies on this assumption.}





%% \subsection{Operation interpretation, variable symbols}\label{ssec:operation-interpretation-syntax}
Next we define a convenient shorthand for the interpretation of an operation symbol. We use this often in the sequel.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}ÃÇ\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}%
\>[48]\AgdaSymbol{‚Üí}%
\>[51]\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\<%
\end{code}
\ccpad
This is similar to the standard notation that one finds in the literature and seems much more natural to us than the double bar notation that we started with.

%% \subsection{Arbitrarily many variable symbols}
We assume that we always have at our disposal an arbitrary collection \ab X of variable symbols such that, for every algebra \ab ùë®, no matter the type of its domain, we have a surjective map \ab{h‚ÇÄ} \as : \ab X \as ‚Üí \aiab{‚à£}{ùë®} from variables onto the domain of \ab ùë®.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚Ü†\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚Ü†}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaBound{h}\<%
\end{code}
\ccpad
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% \subsection{Product algebra type}\label{ssec:product-algebra-type}
%% This section describes some parts of the \ualibAlgProducts module of the \agdaualib.
Finally, we define the type of \defn{product algebras} the obvious way.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùìò}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìò}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{\}(}\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìò}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
%
\>[1]\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùìò}\AgdaSymbol{\}\{}\AgdaBound{I}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{((}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{j}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{j}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{I}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùíú}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{Œª\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{\}}\<%
\end{code}















\section{Quotient Types and Quotient Algebras}\label{sec:quotient-types-and-quotient-algebras}
For a binary relation \ab R on \ab A, we denote a single \ab R-class by \af [ \ab a \af ] \ab R (this denotes the class containing \ab a). We denote the type of all classes of a relation \ab R on \ab A by \af ùíû \as{\{} \ab A \as{\}} \as{\{} \ab R \as{\}}.  These are defined as in the \ualib as follows.
\ccpad
\begin{code}%
\>[1]\AgdaOperator{\AgdaFunction{[\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\\
\>[1]\AgdaFunction{ùíû}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚Å∫}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaFunction{ùíû}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{C}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\<%
\end{code}
\ccpad
There are a few ways we could define the quotient with respect to a relation. We have found the following to be the most convenient.
\ccpad
\begin{code}%
\>[1]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}/\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚Å∫}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaFunction{,}%
\>[27]\AgdaFunction{ùíû}\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{C}\<%
\end{code}
\ccpad
We then have the following introduction and elimination rules for a class with a designated representative.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶\AgdaUnderscore{}‚üß}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaBound{R}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚ü¶}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚üß}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{R}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{a}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùìá‚ÑØùíªùìÅ}\<%
\end{code}
\ccpad
\begin{code}
\>[1]\AgdaOperator{\AgdaFunction{‚åú\AgdaUnderscore{}‚åù}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}\{}\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{/}}\AgdaSpace{}%
\AgdaBound{R}%
\>[39]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[1]\AgdaOperator{\AgdaFunction{‚åú}}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚åù}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}%
\end{code}














\subsection{Quotient extensionality}\label{ssec:quotient-extensionality}
We will need a subsingleton identity type for congruence classes over sets so that we can equate two classes, even when they are presented using different representatives. For this we assume that our relations are on sets, rather than arbitrary types. As mentioned earlier, this is equivalent to assuming that there is at most one proof that two elements of a set are the same.  The following \emph{class extensionality principle} accomplishes this for us.
\ccpad
\begin{code}%
\input{aux/class-extensionality.tex}
\end{code}
\ccpad
We omit the proof. \seedocfordetails



\subsection{Compatibility}\label{ssec:compatibility}
We say that a (unary) operation \ab f \as : \ab X \as ‚Üí \ab X is \defn{compatible} with (or \defn{respects}, or \defn{preserves}) the binary relation \ab R on \ab X just in case \as ‚àÄ \ab x, \ab y \as : X, we have \ab R \ab x \ab y \as ‚Üí  \ab R (\ab f \ab x) (\ab f \ab y).  Now suppose \ab ùì§, \ab ùì•, and \ab ùì¶ are universes and assume the following typing judgments: \ab Œ≥ \as : \ab ùì• \af Ãá, \ab X \as : \ab ùì§ \af Ãá. We lift the definition of compatibility from unary to \ab Œ≥-ary operations in the following obvious way: for all \ab u \ab v \as : \ab Œ≥ \as ‚Üí \ab X (\ab Œ≥-tuples of \ab X), we say that the pair \ab u \ab v is \ab R-related, and we write \AgdaFunction{lift-rel}~\ab R~\ab u~\ab v provided \as ‚àÄ \ab i \as : \ab Œ≥, \ab R (\ab u \ab i) (\ab v \ab i). The function \af{lift-rel} is defined as follows.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{lift-rel}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaBound{Z}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ≥}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{Œ≥}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{Z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaFunction{lift-rel}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}
\ccpad
If \ab f \as : (\ab Œ≥ \as ‚Üí \ab X) \as ‚Üí \ab X is a \ab Œ≥-ary operation on \ab X, we say that \ab f is \defn{compatible} with \ab R provided for all \ab u \ab v : \ab Œ≥ \as ‚Üí \ab X, \af{lift-rel} \ab R \ab u \ab v implies \ab R (\ab f \ab u) (\ab f \ab v).
\ccpad
\begin{code}
\>[1]\AgdaFunction{compatible-op}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaFunction{compatible-op}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ\{}\AgdaBound{ùíÇ}\AgdaSymbol{\}\{}\AgdaBound{ùíÉ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{lift-rel}\AgdaSpace{}%
\AgdaBound{R}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaBound{ùíÉ}%
\>[53]\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùíÉ}\AgdaSymbol{)}\<%
\end{code}
\ccpad
Finally, to represent that all basic operations of an algebra are compatible with a given relation, we define
\ccpad
\begin{code}
\>[1]\AgdaFunction{compatible}\AgdaSpace{}%
\AgdaSymbol{:}{\AgdaSpace{}}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Rel}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaFunction{compatible}%
\>[13]\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{R}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{‚àÄ}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{compatible-op}\AgdaSymbol{\{}\AgdaBound{ùë®}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{R}\<%
\end{code}
\ccpad
We'll see this definition of compatibility at work very soon when we define congruence relations in the next section.


\subsection{Congruence relations}\label{ssec:congr-relat}
This \ualibCongruences module of the \agdaualib defines 
three alternative representations of congruence relations of an algebra---first as a function, then as a predicate on binary relations, and finally as a record type.
\ccpad
\begin{code}%
  \input{aux/Congruences.tex}
\end{code}







\subsection{Quotient algebras}\label{ssec:quotient-algebras}
An important construction in universal algebra is the quotient of an algebra \ab ùë® with respect to a congruence relation \ab Œ∏ of \ab ùë®. This quotient is typically denote by \ab ùë® \as / \ab Œ∏ and Agda allows us to define and express quotients using this standard notation.
\ccpad
\begin{code}%
  \input{aux/Quotient-algebras.tex}
\end{code}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Subalgebras, homomorphisms, and terms %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homomorphisms, terms, and subalgebras}\label{sec:homom-terms-subalg}

\subsection{Homomorphisms}\label{ssec:homomorphisms}
%% This section describes parts of the \ualibHomBasic module of the \agdaualib.

The definition of homomorphism we use is a standard, \emph{extensional} one; that is, the homomorphism condition holds pointwise. This will become clearer once we have the formal definitions in hand. Generally speaking, though, we say that two functions \ab ùëì \ab ùëî \as : \ab X \as ‚Üí \ab Y are extensionally equal iff they are pointwise equal, that is, for all \ab x \as : \ab X we have \ab ùëì \ab x \af ‚â° \ab ùëî \ab x.

To define \emph{homomorphism}, we first say what it means for an operation \ab ùëì, interpreted in the algebras \ab ùë® and \ab ùë©, to commute with a function \ab ùëî \as : \ab A \as ‚Üí \ab B.
\ccpad
\begin{code}
\input{aux/hom1.tex}
\end{code}
\ccpad
Note the appearance of the shorthand \as ‚àÄ \ab ùíÇ in the definition of \af{compatible-op-map}. We can get away with this in place of \ab ùíÇ \as : \af ‚à• \ab ùëÜ \af ‚à• \ab ùëì \as ‚Üí \af ‚à£ \ab ùë® \af ‚à£ since Agda is able to infer that the \ab ùíÇ here must be a tuple on \af ‚à£ \ab ùë® \af ‚à£ of ``length'' \af ‚à• \ab ùëÜ \af ‚à• \ab ùëì (the arity of \ab ùëì).

Next we will define the type \af{hom} \ab ùë® \ab ùë© of \emph{homomorphisms} from \ab ùë® to \ab ùë© in terms of the property \af{is-homomorphism}.
\ccpad
\begin{code}%
\input{aux/hom2.tex}
\end{code}
\ccpad

We define an inductive datatype called \ad{Term} which, not surprisingly, represents the type of \defn{terms} in a given signature. Here the type \ab X \as :~\ab ùìß \af Ãá represents an arbitrary collection of variable symbols.
\ccpad
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚Å∫}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}%
\>[51]\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{generator}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaInductiveConstructor{node}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)(}\AgdaBound{args}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\end{code}







\subsection{Terms}\label{ssec:terms}
Terms can be viewed as acting on other terms and we can form an algebraic structure whose domain and basic operations are both the collection of term operations. We call this the \defn{term algebra} and denote it by \af ùëª \ab X.
\ccpad
\begin{code}%
\>[0]\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚Å∫}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
\>[0]\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{node}\<%
\end{code}


%% \subsection{The universal property}\label{ssec:the-universal-property}
The term algebra is \defn{absolutely free}, or \defn{universal}, for algebras in the signature ùëÜ. That is, for every ùëÜ-algebra ùë®, every map \ab h \as :~\ab ùëã \as ‚Üí \af ‚à£ \ab ùë® \af ‚à£ lifts to a homomorphism from \af ùëª \ab X to \ab ùë®, and the induced homomorphism is unique. This is proved by induction on the structure of terms, as follows.
\ccpad
\begin{code}%
\input{aux/universal.tex}
\end{code}











\subsection{Subalgebras}\label{ssec:subalgebras}

\subsubsection{Subuniverses}
The \ualibSubuniverses module defines, unsurprisingly, the \af{Subuniverses} type. Perhaps counterintuitively, we begin by defining the collection of all subuniverses of an algebra. Therefore, the type will be a predicate of predicates on the domain of the given algebra.
\ccpad
\begin{code}
  \input{aux/subuniverses.tex}
\end{code}
\ccpad
%% \subsubsection{Subuniverse generation}\label{sec:subuni-genera}
An important concept in universal algebra is the subuniverse generated by a subset of the domain of an algebra.  We define the following inductive type to represent this concept.
\ccpad
\begin{code}
  \input{aux/generation.tex}
\end{code}
\ccpad
The proof that \af{Sg} \ab X is a subuniverse is as trivial as they come.
\ccpad
\begin{code}
\>[0]\AgdaFunction{sgIsSub}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaDatatype{Sg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Subuniverses}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\\
\>[0]\AgdaFunction{sgIsSub}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{app}\<%
\end{code}
\ccpad
And the proof that \af{Sg} \ab X is the smallest subuniverse containing \ab X is not much harder and proceeds by induction on the shape of elements of \af{Sg} \ab X.
\ccpad
\begin{code}
\>[0]\AgdaFunction{sgIsSmallest}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSymbol{\}(}\AgdaBound{Y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùì°}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[15]\AgdaBound{Y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{Subuniverses}\AgdaSpace{}%
\AgdaBound{ùë®}%
\>[35]\AgdaSymbol{‚Üí}%
\>[38]\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaBound{Y}%
\>[45]\AgdaSymbol{‚Üí}%
\>[48]\AgdaDatatype{Sg}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaBound{Y}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{sgIsSmallest}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{X‚äÜY}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{var}\AgdaSpace{}%
\AgdaBound{v‚ààX}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{X‚äÜY}\AgdaSpace{}%
\AgdaBound{v‚ààX}\<%
\\
\>[0]\AgdaFunction{sgIsSmallest}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaBound{Y‚â§A}\AgdaSpace{}%
\AgdaBound{X‚äÜY}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{app}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{fa‚ààY}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{IH}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Im}}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äÜ}}\AgdaSpace{}%
\AgdaBound{Y}\<%
\\
%
\>[2]\AgdaFunction{IH}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{sgIsSmallest}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{Y}\AgdaSpace{}%
\AgdaBound{Y‚â§A}\AgdaSpace{}%
\AgdaBound{X‚äÜY}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{fa‚ààY}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ÃÇ}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{Y}\<%
\\
%
\>[2]\AgdaFunction{fa‚ààY}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{Y‚â§A}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaFunction{IH}\<%
\end{code}
\ccpad
Evidently, when the element of \af{Sg} \ab X is constructed as \aic{app} \ab f \ab ùíÇ \ab p, we may assume (the induction hypothesis) that the arguments \ab ùíÇ belong to \ab Y. Then the result of applying \ab f to \ab ùíÇ must also belong to \ab Y, since \ab Y is a subuniverse.


\subsubsection{Subalgebra type}\label{sssec:subalgebra-type}
Given algebras \ab ùë®~\as :~\af{Algebra} \ab ùì¶ \ab ùëÜ and \ab ùë©~\as :~\af{Algebra} \ab ùì§ \ab ùëÜ, we say that \ab ùë© is a \defn{subalgebra} of \ab ùë®, and (in the \ualib) we write \af ùë© \af{IsSubalgebraOf} \ab ùë®, just in case \ab ùë© can be embedded in \ab ùë®; in other terms, there exists a map \ab h~\as :~\af ‚à£ \ab ùë® \af ‚à£ ‚Üí \af ‚à£ ùë© \af ‚à£ from the universe of \ab ùë® to the universe of \ab ùë© such \ab h is an embedding (i.e., \af{is-embedding} \ab h holds) and \ab h is a homomorphism from \ab ùë® to \ab ùë©.
\ccpad
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}IsSubalgebraOf\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
\>[0]\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsSubalgebraOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaFunction{is-embedding}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaFunction{is-homomorphism}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaBound{h}\<
\end{code}
\ccpad
Here is some convenient syntactic sugar for the subalgebra relation.
\ccpad
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}‚â§\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùì†}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}(}\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì†}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaBound{ùìû}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì•}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùì†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
\>[0]\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ùë©}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{IsSubalgebraOf}}\AgdaSpace{}%
\AgdaBound{ùë®}\<%
\end{code}
\ccpad
We can now write \AgdaBound{ùë©} \AgdaOperator{\AgdaFunction{‚â§}} \AgdaBound{ùë®} to assert that ùë© is a subalgebra of ùë®.






%% Varieties %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Equations and Varieties}\label{sec:equations-and-varieties}

Let \ab ùëÜ be a signature. By an \defn{identity} or \defn{equation} in \ab ùëÜ we mean an ordered pair of terms, written \ab ùëù \aof ‚âà \ab ùëû, from the term algebra \af ùëª \ab X. If \ab ùë® is an \ab ùëÜ-algebra we say that \ab ùë® \defn{satisfies} \ab ùëù \aof ‚âà \ab ùëû provided \ab ùëù \af Ãá \ab ùë® \aod ‚â° \ab ùëû \aof Ãá \ab ùë® holds. In this situation, we write \ab ùë® \aof ‚äß \ab ùëù \aof ‚âà \ab ùëû and say that \ab ùë® \defn{models} the identity \ab ùëù \aof ‚âà \ab q. If \ab ùí¶ is a class of algebras, all of the same signature, we write \ab ùí¶ \aof ‚äß \ab p \aof ‚âà \ab q if, for every \ab ùë® \aof ‚àà \ab ùí¶, \ab ùë® \aof ‚äß \ab ùëù \aof ‚âà \ab ùëû.\footnote{Because a class of structures has a different type than a single structure, we must use a slightly different syntax to avoid overloading the relations \af ‚äß and \af ‚âà. As a reasonable alternative to what we would normally express informally as ùí¶ \aof ‚äß \ab ùëù \aof ‚âà \ab ùëû, we have settled on \ab ùí¶ \aof ‚äß \ab p \aof ‚âã \ab q to denote this relation.  To reiterate, if \ab ùí¶ is a class of \ab ùëÜ-algebras, we write \ab ùí¶ \aof ‚äß \ab ùëù \aof ‚âã \ab ùëû if every \ab ùë® \aof ‚àà \ab ùí¶ satisfies \ab ùë® \aof ‚äß \ab ùëù \aof ‚âà \ab ùëû.}

\subsection{Types for Theories and Models}\label{ssec:types-for-theories-and-models}
%% We define types that represent \defn{identites} of terms in a given signature and what it means for a structure to satisfy, or \defn{model}, such identities.

The binary ``models'' relation \aof ‚äß relating algebras (or classes of algebras) to the identities that they satisfy is defined in the \ualibModelTheory module.  Agda supports the definition of infix operations and relations, and we use this to define \aof ‚äß so that we may write, e.g., \ab ùë® \aof ‚äß \ab p \aof ‚âà \ab q or \ab ùí¶ \aof ‚äß \ab p \aof ‚âã \ab q.
\ccpad
\begin{code}%
\input{aux/Models.tex}
\end{code}
\ccpad

The \agdaualib makes available the standard notation \af{Th} \ab ùí¶ for the set of identities that hold for all algebras in a class \ab ùí¶, as well as \af{Mod} \ab ‚Ñ∞ for the class of algebras that satisfy all identities in a given set \ab ‚Ñ∞.
\ccpad
\begin{code}%
  \input{aux/Theories.tex}
\end{code}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% temporarily omitting this section for lack of space
\begin{comment}
\subsection{Equational logic types}\label{ssec:equational-logic-types}
We now state without proof some ``invariance'' properties of the models relation \aof ‚äß defined above.\footnote{The complete formal proofs in Agda are available in the \ualib source code files (\ualibsrc) and in the html documentation (\href{https://ualib.gitlab.io/UALib.Varieties.EquationalLogic.html}{\texttt{ualib.gitlab.io/UALib.Varieties.EquationalLogic.html}})} These are needed, for example, in the proof the Birkhoff HSP Theorem.
%% %% Specifically, we will prove the following facts (needed, for example, in the proof of Birkhoff's Theorem).
%% \begin{itemize}
%%   \item (\S\ref{sssec:algebraic-invariance}) \aof ‚äß is an \emph{algebraic invariant} (stable under isomorphism);
%%   \item (\S\ref{sssec:subalgebraic-invariance}) \aof ‚äß is a \emph{subalgebraic invariant} (stable under the taking of subalgebras);
%%   \item (\S\ref{sssec:product-invariance}) \aof ‚äß is stable under the taking of arbitrary products.
%% \end{itemize}
%% \subsubsection{Algebraic invariance}\label{sssec:algebraic-invariance}

The binary relation \aof ‚äß would be practically useless if it were not an \emph{algebraic invariant} (invariant under isomorphism). Before we prove this, let us clarify how one computes with (extensional) identities.
We have formally defined \ab ùë® \aof ‚äß \ab ùëù \aof ‚âà \ab ùëû, which represents the assertion that \ab p \aof ‚âà \ab q holds when this identity is interpreted in the algebra \ab ùë®; syntactically, \ab ùëù \aof Ãá \ab ùë® \aof ‚â° \ab ùëû \aof Ãá \ab ùë®.  Computationally, the expression \ab ùëù \aof Ãá \ab ùë® \aof ‚â° \ab ùëû \aof Ãá \ab ùë® is interpreted as an \emph{extensional equality}, by which we mean that for each \emph{assignment function} \ab ùíÇ \as : \ab X \as ‚Üí \aiab{‚à£}{ùë®}, assigning values in the domain of \ab ùë® to the variable symbols in \ab X, we have (\ab ùëù \aof Ãá \ab ùë®) \ab ùíÇ \aof ‚â° (\ab ùëû \aof Ãá \ab ùë®) \ab ùíÇ.
\ccpad
\begin{code}%
\input{aux/I-invariance.tex}
\end{code}
\ccpad
As the proof makes clear, we show \ab ùë© \aof ‚äß \ab p \aof ‚âà \ab q by proving that \ab p \af Ãá \ab ùë© \aod ‚â° \ab q \af Ãá \ab ùë© holds \emph{extensionally}, that is, \as ‚àÄ \ab x, (\ab p \af Ãá \ab ùë©) \ab x \aod ‚â° (\ab q \af Ãá \ab ùë©) \ab x.

We will also need to know that the \aof ‚äß relation is compatible with the \AgdaFunction{lift-alg} and \af{lower-alg} operations defined in \S\ref{ssec:the-lift-of-an-algebra}. We omit the easy proofs. \seedocfordetails

%% \subsubsection{Subalgebraic invariance}\label{sssec:subalgebraic-invariance}
An identity is modeled by a class of algebras if and only if it is modeled by all subalgebras of algebras in the class.  One direction is obvious, so we only show here the nontrivial direction; i.e., every term equation \ab p \aof ‚âà \ab q that is modeled by \ab ùí¶ is also modeled by every subalgebra of every member of \ab ùí¶.
\ccpad
\begin{code}%
\input{aux/S-invariance.tex}
\end{code}

%% \subsubsection{Product invariance}\label{sssec:product-invariance}
An identity is modeled by a class of algebras if and only if it is modeled by all products of algebras in the class.
\ccpad
\begin{code}%
\input{aux/P-invariance.tex}
\end{code}
\ccpad
%% The following will also come in handy. We omit the proof. \seedocfordetails
\ccpad
\begin{code}%
\input{aux/P-lift-invariance.tex}
\end{code}
As usual, for the omitted proofs, we refer the reader to the \ualib and its documentation. \seedocfordetails
\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%









\subsection{Inductive types for closure operators}\label{sec:inductive-types-h-s-p-v}
%% This section presents the \ualibVarietiesVarieties module of the \agdaualib.

Fix a signature \ab ùëÜ, let \ab ùí¶ be a class of \ab ùëÜ-algebras, and define
\begin{itemize}
\item
  \af H \ab ùí¶ = algebras isomorphic to a homomorphic image of a members of \ab ùí¶;
\item
  \af S \ab ùí¶ = algebras isomorphic to a subalgebra of a member of \ab ùí¶;
\item
  \af P \ab ùí¶ = algebras isomorphic to a product of members of \ab ùí¶.
\end{itemize}
%% A straight-forward verification confirms that \af H, \af S, and \af P are \defn{closure operators} (expansive, monotone, and idempotent). A class \ab ùí¶ of \ab ùëÜ-algebras is said to be \defn{closed under the taking of homomorphic images} provided \af H \ab ùí¶ \aof ‚äÜ \ab ùí¶. Similarly, \ab ùí¶ is \emph{closed under the taking of subalgebras} (resp., \emph{arbitrary products}) provided \af S \ab ùí¶ \aof ‚äÜ \ab ùí¶ (resp., \af P \ab ùí¶ \aof ‚äÜ \ab ùí¶). An algebra is a homomorphic image (resp., subalgebra; resp., product) of every algebra to which it is isomorphic. Thus, the class \af H \ab ùí¶ (resp., \af S \ab ùí¶; resp., \af P \ab ùí¶) is closed under isomorphism. The operators \af H, \af S, and \af P can be composed with one another repeatedly, forming yet more closure operators. 
A \defn{variety} is a class \ab ùí¶ of algebras in a fixed signature that is closed under the taking of homomorphic images (\af H), subalgebras (\af S), and arbitrary products (\af P). That is, \ab ùí¶ is a variety if and only if
\af H \af S \af P \ab ùí¶ \aof ‚äÜ \ab ùí¶.

The \ualibVarietiesVarieties module of the \agdaualib introduces three new inductive types that represent the closure operators \af H, \af S, \af P. Separately, an inductive type \af V is defined which represents closure under all three operators. These definitions have been fine-tuned to strike a balance between faithfully representing the desired semantics and facilitating proof by induction.
%% \\[5pt]
%% \textbf{Notation}. Recall, if \ab ùì§\AgdaSpace{}\as{:}~\af{Universe} and \ab ùëÜ\AgdaSpace{}\as{:}~\af{Signature} \ab ùìû \ab ùì•, then \af{Algebra} \ab ùì§ \ab ùëÜ denotes the type of algebras with domains of type \ab ùì§ \af Ãá.  Of course, the type \af{Algebra} \ab ùì§ \ab ùëÜ itself has a type; it is \ab ùìû \af ‚äî \ab ùì• \af ‚äî \ab ùì§ \af ‚Å∫ \af Ãá.  The level of this type is frequently abbreviated in the sequel as follows: \AgdaFunction{OV}\AgdaSpace{}\ab ùì§ := \ab ùìû \af ‚äî \ab ùì• \af ‚äî \ab ùì§ \af ‚Å∫.
%% The inductive types that we have found most useful for representing the fact that a class of algebras is closed under the taking of homomorphic images is defined as follows.
\ccpad
\begin{code}%
  \input{aux/H.tex}
\end{code}
%% \ccpad
%% The most useful inductive type that we have found for representing classes of algebras that are closed under the taking of subalgebras as an inductive type.
\ccpad
\begin{code}%
  \input{aux/S.tex}
\end{code}
%% \ccpad
%% We have found the following to be the most useful inductive type for representing classes of algebras closed under arbitrary products.
\ccpad
\begin{code}%
  \input{aux/P.tex}
\end{code}
\ccpad
%% Recall, a class \ab ùí¶ of \ab ùëÜ-algebras is called a \defn{variety} if it is closed under each of the closure operators \ad H, \ad S, and \ad P. 
The operator that corresponds to closure with respect to \ad H\ad S\ad P is often denoted by ùïç; we represent it by the inductive type \ad V, defined as follows.
\ccpad
\begin{code}%
  \input{aux/V.tex}
\end{code}
\ccpad
Thus, if \ab ùí¶ is a class of \ab ùëÜ-algebras, then the \defn{variety generated by} \ab ùí¶---that is, the smallest class that contains \ab ùí¶ and is closed under \ad H, \ad S, and \ad P---is \ad V \ab ùí¶.




\subsection{Class products, PS ‚äÜ SP and ‚®Ö S ‚àà SP}\label{ssec:class-products-and-inclusions}
There are two main results we need to establish about the closure operators defined in the last section.  The first is the inclusion \ad P\ad S(\ab ùí¶) ‚äÜ \ad S\ad P(\ab ùí¶). The second requires that we construct the product of all subalgebras of algebras in an arbitrary class, and then show that this product belongs to \ad S\ad P(\ab ùí¶).  These are both nontrivial formalization tasks with rather lengthy proofs, which we omit.  However, the interested reader can view the complete proofs on the web page \href{https://ualib.gitlab.io/UALib.Varieties.Varieties.html}{ualib.gitlab.io/UALib.Varieties.Varieties.html} or by looking at the source code of the \ualibVarieties module at \href{https://gitlab.com/ualib/ualib.gitlab.io/-/blob/master/UALib/Varieties/Varieties.lagda}{gitlab.com/ualib}.

Here is the formal statement of the first goal, along with the first few lines of proof.\footnote{For legibility we use \AgdaFunction{ovùìæ} as a shorthand for
  \AgdaGeneralizable{ùìû} \AgdaOperator{\AgdaPrimitive{‚äî}}
  \AgdaGeneralizable{ùì•} \AgdaOperator{\AgdaPrimitive{‚äî}}
  \AgdaBound{ùì§} \AgdaOperator{\AgdaPrimitive{‚Å∫}}.}
\ccpad
\begin{code}%
  \input{aux/classinclusion.tex}
\end{code}
\ccpad
Evidently, the proof is by induction on the form of an inhabitant of \ad P\ad S(\ab ùí¶), handling in turn each way such an inhabitant can be constructed. \seedocfordetails

%% More interesting, perhaps, is the second goal which is to formally implement the product of all subalgebras of algebras in a given class and then to show that this product belongs to \ad S\ad P(\ab ùí¶).

%% \subsubsection{The product of a class of algebras}\label{sssec:the-product-of-a-class-of-algebras}
Next we formally state and prove that, given an arbitrary class \ab ùí¶ of algebras, the product of all algebras in the class \ad S(\ab ùí¶) belongs to \ad S\ad P(\ab ùí¶).\footnote{This turned out to be a nontrivial exercise. In fact, it is not even immediately obvious (at least not to this author) how one should express the product of an entire arbitrary class of algebras as a dependent type. However, after a number of failed attempts, the right type revealed itself. Now that we have it, it seems almost obvious.}
The type that serves to index the class (and the product of its members) is the following.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}%
\>[23]\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\<%  \input{aux/classproduct1.tex}
\end{code}
\ccpad
Taking the product over this index type \af ‚Ñë requires a function like the following, which takes an index (i : ‚Ñë) and returns the corresponding algebra. Here is such a function.
\ccpad
\begin{code}
\>[1]\AgdaFunction{ùîÑ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
%
\>[1]\AgdaFunction{ùîÑ}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\end{code}
\ccpad
Finally, the product of all members of ùí¶ is represented by the following type.
\ccpad
\begin{code}
\>[1]\AgdaFunction{class-product}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
%
\>[1]\AgdaFunction{class-product}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{ùîÑ}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{)}\<%  \input{aux/classproduct2.tex}
\end{code}
\ccpad
If \ab p \as :~\ab ùë® \as ‚àà \ab ùí¶ is a proof that \ab ùë® belongs to \ab ùí¶, then we can view the pair (\ab ùë®, \ab p) \as ‚àà \af ‚Ñë\ \ab ùí¶ as an index over the class, and \af ùîÑ(\ab ùë® , \ab p) as the result of projecting the product %% \af ‚®Ö \af ùîÑ\as{\{}\ab ùì§\as{\}\{}\ab ùí¶\as{\}} 
onto the (\ab ùë®, \ab p)-th component.
%% \subsubsection{‚®Ö S(ùí¶) ‚àà SP(ùí¶)}\label{sssec:classproduct-inclusion}
Thus, the (informal) product \af ‚®Ö \ad S(\ab ùí¶) of all subalgebras of algebras in \ab ùí¶ is implemented (formally) in the \ualib as \af ‚®Ö \as (\af ùîÑ\as{\{}\ab ùì§\as{\}\{}\ad S\as{(}\ab ùí¶\as{)\})}, and our goal is to prove that this product %% \af ‚®Ö \as (\af ùîÑ\as{\{}\ab ùì§\as{\}\{}\ad S\as{(}\ab ùí¶\as{)\})} 
belongs to \ad S\ad P(\ab ùí¶). This is done in the \ualib by first proving that the product belongs to \ad P\ad S(\ab ùí¶) (see the proof of \AgdaFunction{class-prod-s-‚àà-ps} in \ualibVarieties) and then applying the \AgdaFunction{PS‚äÜSP} lemma described above.

%% \ccpad
%% \begin{code}%
%%   \input{aux/classproduct-inclusion1.tex}
%% \end{code}
%% \ccpad
%% Since PS‚äÜSP, it follows that the product of all subalgebras of algebras in the class \ab ùí¶ belongs to \ad S\ad P(\ab ùí¶).
%% \ccpad
%% \begin{code}
%%   \input{aux/classproduct-inclusion2.tex}
%% \end{code}

%% \subsection{Equation Preservation Theorems}\label{sec:equation-preservation-theorems}
%% This section presents the \ualibPreservation module of  the \agdaualib.
%% \input{Varieties/Preservation.tex}




\subsection{Equation preservation}\label{equation-preservation}
This section describes parts of the \ualibPreservation module of the \agdaualib, in which it is proved that identities are preserved by closure operators \ad H, \ad S, and \ad P. This will establish the easy direction of Birkhoff's HSP theorem.  We present only the formal statements, omitting proofs. \seedocfordetails
%% \subsubsection{H preserves identities}\label{sssec:h-preserves-identities}
For example, the assertion that \ad H preserves identities is stated formally as follows:
\ccpad
\begin{code}[number=code:H1]%
\>[0]\AgdaFunction{H-id1}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[50I]\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Universe}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSymbol{\}\{}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)(}\AgdaFunction{ov}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSymbol{)\}}\<%
\\
\>[.][@{}l@{}]\<[50I]%
\>[8]\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSymbol{\{}\AgdaBound{ùìß}\AgdaSymbol{\}\{}\AgdaBound{X}\AgdaSymbol{\})}\<%
\\
%
\>[8]\AgdaComment{-----------------------}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[1]\AgdaSymbol{‚Üí}%
\>[8]\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âã}}\AgdaSpace{}%
\AgdaBound{q}%
\>[19]\AgdaSymbol{‚Üí}%
\>[22]\AgdaDatatype{H}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaBound{ùì§}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äß}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚âã}}\AgdaSpace{}%
\AgdaBound{q}\<%  \input{aux/H1-short.tex}
\end{code}
\ccpad
\ccpad
The proof is by induction and handles each of the four constructors of \ad H (\AgdaInductiveConstructor{hbase},
\AgdaInductiveConstructor{hlift}, \AgdaInductiveConstructor{hhimg}, and \AgdaInductiveConstructor{hiso}) in turn. Of course, the \ualibPreservation module of the \ualib contains a complete proof of (\ref{code:H1}), which can be viewed in the source code or the html documentation.\footnote{\label{note1}See the source code file \href{https://gitlab.com/ualib/ualib.gitlab.io/-/blob/master/UALib/Varieties/Preservation.lagda}{Preservation.lagda}, or the html documentation page\\ \href{https://ualib.gitlab.io/UALib.Varieties.Preservation.html}{ualib.gitlab.io/UALib.Varieties.Preservation.html}.}
%% The converse is almost too obvious to bother with. Nonetheless, it is formalized as follows:
%% \ccpad
%% \begin{code}
%%   \input{aux/H2-short.tex}
%% \end{code}
%% \ccpad
%% \subsubsection{S preserves identities}\label{s-preserves-identities}
%% \ccpad
The facts that \ad S, \ad P, and \ad V preserve identities are presented in the \ualib in a similar way (and named \af{S-id1}, \af{P-id1}, \af{V-id1}, respectively). As usual, the full proofs are available in the \ualib source code and documentation.\cref{note1}%%  We present the statements here without further discussion.
%% \ccpad
%% \begin{code}[number=code:S1]%
%%   \input{aux/S1-short.tex}
%% \end{code}
%% \ccpad
%% \begin{code}%
%%   \input{aux/P1-short.tex}
%% \end{code}
%% \ccpad
%% \begin{code}%
%%   \input{aux/V1-short.tex}
%% \end{code}
%% Once again, and for the last time, completeness dictates that we formalize the converse, obvious though it may be.
%% \ccpad
%% \begin{code}%
%%   \input{aux/V2.tex}
%% \end{code}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% temporarily omitting this section for lack of space
\begin{comment}
\subsubsection{Class identities}\label{class-identities}
It follows from \af{V-id1} that, if \ab ùí¶ is a class of structures, then the collection of identities modeled by all structures in \ab ùí¶ is precisely the collection of identities modeled by all structures in \af V \ab ùí¶.  The latter is denoted \AgdaFunction{Th}(\AgdaDatatype{V} \AgdaBound{ùí¶}).
\ccpad
\begin{code}%
  \input{aux/ClassIdentities.tex}
\end{code}
\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%






















%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The Free Algebra}\label{ssec:free-algebra-type}
In this section, we formalize, for a given class \ab ùí¶ of \ab ùëÜ-algebras, the (relatively) \defn{free algebra in} \ad S~(\ad P~\ab ùí¶) \defn{over} \ab X. Let \af Œò(\ab ùí¶, \ab ùë®) := \{\ab Œ∏ \af ‚àà \af{Con} \ab ùë® \as : \ab ùë® \af / \ab Œ∏ \af ‚àà \ad S \ab ùí¶\} and \af œà(\ab ùí¶, \ab ùë®) := \af ‚ãÇ \af Œò(\ab ùí¶, \abùë®).
%% The free algebra is constructed by applying these definitions to the special case in which \ab ùë® is the term algebra \af ùëª \ab X of \ab ùëÜ-terms over \ab X.  
Since the term algebra \af ùëª \ab X is free for the class $ùíúùìÅ‚Ñä(ùëÜ)$ of all \ab ùëÜ-algebras, it follows that \af ùëª \ab X is free for every subclass \ab ùí¶ of $ùíúùìÅ‚Ñä(ùëÜ)$. Although \af ùëª \ab X is not necessarily a member of \ab ùí¶, if we form the quotient ùîâ \as := (\ab ùëª \ab X) \af / \af œà(\ab ùí¶, \af ùëª \ab X), of \af ùëª \ab X modulo the congruence

\af œà(\ab ùí¶, \af ùëª \ab ùëã) := \af ‚ãÇ \{\ab Œ∏ \af ‚àà \af{Con} (\af ùëª \ab X) \as : (\af ùëª \ab X) \af / \ab Œ∏ \af ‚àà \ad S(\ab ùí¶)\},\\
then it should be clear that \af ùîâ is a subdirect product of the algebras in \{(\af ùëª \ab X) \af / \ab Œ∏\}, where \ab Œ∏ ranges over \{\ab Œ∏ \af ‚àà \af{Con} (\af ùëª \ab X) \as : (\af ùëª \ab X) \af / \ab Œ∏ \af ‚àà \ad S(\ab ùí¶)\}
The algebra \af ùîâ so defined is called the \defn{free algebra over} \ab ùí¶ \defn{generated by} \ab X and (because of what we just observed) we say that \af ùîâ is free \emph{in} \ad S(\ad P \ab ùí¶).

To represent \af ùîâ as a type in \agda, we must formally construct the congruence \af œà(\ab ùí¶, \af ùëª \ab ùëã).
%% which, recall, is defined as follows:\\
%% \af œà(\ab ùí¶, \af ùëª \ab ùëã) := \af ‚ãÇ \af Œò(\ab ùí¶, \af ùëª \ab X) := \af ‚ãÇ \{\ab Œ∏ \af ‚àà \af{Con} (\af ùëª \ab X) \as : \ab ùë® \af / \ab Œ∏ \af ‚àà \ad S \ab ùí¶\}.\\
%% \\
We begin by defining the collection \af{ùëªimg} of homomorphic images of the term algebra.
\ccpad
\begin{code}%
\>[0]\<%
\>[1]\AgdaFunction{ùëªimg}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚äî}}\AgdaSpace{}%
\AgdaBound{ùìß}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚Å∫}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\<%
\\
%
\>[1]\AgdaFunction{ùëªimg}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaFunction{Œ£}\AgdaSpace{}%
\AgdaBound{œï}\AgdaSpace{}%
\AgdaFunction{Íûâ}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaFunction{,}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaFunction{Epic}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{œï}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\end{code}
\ccpad
The inhabitants of this Sigma type represent algebras \ab ùë® \af ‚àà \ab ùí¶ such that there exists a surjective homomorphism \ab œï \as : \af{hom} (\af ùëª \ab X) \ab ùë®. Thus, \af{ùëªimg} represents the collection of all homomorphic images of \af ùëª \ab X that belong to \ab ùí¶.  Of course, this is the entire class \ab ùí¶, since the term algebra is absolutely free. Nonetheless, this representation of \ab ùí¶ is useful since it endows each element with extra information.  Indeed, each inhabitant of \af{ùëªimg} \ab ùí¶ is a quadruple, (\ab ùë® , \ab œï , \ab{ka}, \ab p), where \ab ùë® is an \ab ùëÜ-algebra, \ab œï is a homomorphism from \af ùëª \ab X to \ab ùë®, \ab{ka} is a proof that \ab ùë® belongs to \ab ùí¶, and \ab p is a proof that the underlying map \af ‚à£ \ab œï \af ‚à£ is epic.

%% Next we define a function \af{mkti} that takes an arbitrary algebra \ab ùë® and returns an inhabitant of \af{ùëªimg} which is essentially a proof that \ab ùë® is a homomorphic image of \af ùëª \ab X.
%% \ccpad
%% \begin{code}%
%% \>[1]\AgdaFunction{mkti}\AgdaSpace{}%
%% \end{code}
%% \ccpad
Next we define the congruence relation modulo which \af ùëª \ab X yields the relatively free algebra, \af ùîâ \ab ùí¶ \ab X. We start by letting \af œà be the collection of all identities (\ab p, \ab q) satisfied by all subalgebras of algebras in \ab ùí¶,
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{œà}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{√ó}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\<%
\\
%
\>[1]\AgdaFunction{œà}%
\>[4]\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[183I]\AgdaSymbol{‚àÄ(}\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{sA}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaDatatype{S}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaBound{ùì§}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
\>[183I][@{}l@{\AgdaIndent{0}}]%
\>[17]\AgdaSymbol{‚Üí}%
\>[20]\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fst}\AgdaSymbol{(}\AgdaBound{ùïè}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fst}\AgdaSymbol{(}\AgdaBound{ùïè}\AgdaSpace{}%
\AgdaBound{ùë®}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{q},\<%
\end{code}
\ccpad
which we convert %% from a predicate \af œà 
into a relation by \href{https://en.wikipedia.org/wiki/Currying}{Currying},
%% \ccpad
%% \begin{code}%
%% \>[0][@{}l@{\AgdaIndent{1}}]%
%% \>[1]\AgdaFunction{œàRel}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
%% \AgdaSymbol{:}\AgdaSpace{}%
%% \AgdaFunction{Pred}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
%% \AgdaBound{ùì§}\AgdaSpace{}%
%% \AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaFunction{ovùìæ}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaSymbol{‚Üí}\AgdaSpace{}%
%% \AgdaFunction{Rel}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
%% \AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
%% \AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
%% \AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
%% \AgdaFunction{ovùìæ}\<%
%% \\
%% %
%% \>[1]
\AgdaFunction{œàRel}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{œà}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSymbol{)}.
%% \<%
%% \end{code}
%% \ccpad
The relation \af{œàRel} is an equivalence relation and is compatible with the operations of \af ùëª \ab X, which are just the terms themselves.\footnote{We omit the easy proofs, but see the \ualibFreeAlgebra module for details.}  Therefore, from \af{œàRel} we can construct a congruence relation of the term algebra \af ùëª \ab X. The inhabitants of this congruence are pairs of terms representing identities satisfied by all subalgebras of algebras in the class.  We call this \af{œàCon} and define it using the \af{Congruence} constructor \aic{mkcon} as follows.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{œàCon}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Pred}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaRecord{Congruence}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{œàCon}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{mkcon}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œàRel}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œàcompatible}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{œàIsEquivalence}\<%
\end{code}
\ccpad
The free algebra \af ùîâ is then defined as the quotient \af ùëª \ab X \af ‚ï± (\af{œàCon} \ab ùí¶).
\ccpad
\begin{code}%
\>[1]\AgdaFunction{ùîâ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaFunction{ùìï}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
%
\>[1]\AgdaFunction{ùîâ}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[6]\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚ï±}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{œàCon}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\end{code}
\ccpad
where \AgdaFunction{ùìï} \as = (\ab ùìß \AgdaOperator{\AgdaFunction{‚äî}} \af{ovùìæ})\AgdaOperator{\AgdaFunction{‚Å∫}} happens to be the universe level of \af ùîâ. The domain of the free algebra is \af ‚à£ \af ùëª \ab X \af ‚à£ \af / \af ‚ü® \af{œàCon} \ab ùí¶ \af ‚ü©, which is \ad Œ£ \af C \as Íûâ \AgdaUnderscore ~ , \ad Œ£ \ab p \as Íûâ \af ‚à£ \af ùëª \ab X \af ‚à£ ,  \af C \ad ‚â° (\af [ \ab p \af ] \af ‚ü® \af{œàCon} \ab ùí¶ \af ‚ü©), by definition; i.e., the collection
\{\af C \as : \as ‚àÉ \ab p \af ‚àà \aia{‚à£}{\af ùëª \ab X}, \af C \af ‚â° \af[ \ab p \af ] \af ‚ü® \af{œàCon} \ab ùí¶ \af ‚ü©\} of \af ‚ü® \af{œàCon} \ab ùí¶ \af ‚ü©-classes of \af ùëª \ab X.
%% the collection  of \ab œà-classs of \af ùëª \ab X; formally, \aia{‚à£}{\af ùîâ} := \aia{‚à£}{\af ùëª \ab X} \af ‚ï± \af ‚ü® \ab œà \af ‚ü© := \af Œ£ \af C \as Íûâ \au \ac \af Œ£ \ab p \as Íûâ \aia{‚à£}{\af ùëª \ab X} \ac \af C \af ‚â° (\af [ \ab p \af ] \af ‚âà ).

%% {1Since \texttt{X} is not a subset of ùîâ, technically it doesn't make
%% sense to say ``\texttt{X} generates ùîâ.'' But as long as ùí¶ contains a
%% nontrivial algebra, we will have \texttt{œà(ùí¶,\ ùëª\ ùëã)\ ‚à©\ X¬≤\ ‚â†\ ‚àÖ}, and
%% we can identify \texttt{X} with \texttt{X\ /\ œà(ùí¶,\ ùëª\ X)} which does
%% belong to ùîâ.}

































%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%  HSP LEMMAS  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% HSP Theorem %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Birkhoff's HSP Theorem}\label{sec:birkhoff}
This section presents the \ualibBirkhoff module of  the \agdaualib. In \S\ref{ssec:free-algebra-type}, we present a formal representation of the \emph{free algebra} in \ad S (\ad P \ab ùí¶) over \ab X, for a given class \ab ùí¶ of \ab ùëÜ-algebras. In \S\ref{ssec:hsp-lemmas}, we state a number of lemmas needed in \S\ref{ssec:hsp-theorem} where, finally, we present the statement and proof of Birkhoff's HSP theorem.


%%%%%%%%%%%%%%%%%%%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%%%%%%%%%%%%%%%%%%%%%%%
\subsection{HSP Lemmas}\label{ssec:hsp-lemmas}
This subsection gives formal statements of four lemmas that we will string together in \S\ref{ssec:hsp-theorem} to complete the proof of Birkhoff's theorem.

The first hurdle is the \af{lift-alg-V-closure} lemma, which says that if an algebra \ab ùë® belongs to the variety ùïç, then so does its lift. This dispenses with annoying universe level problems that arise later---a minor techinical issue, but the proof is long and tedious, not to mention uninteresting. \seedocfordetails
The next fact that must be formalized is the inclusion \ad S\ad P(\ab ùí¶) \af ‚äÜ \ad V(\ab ùí¶), which also suffers from the unfortunate defect of being boring, so we omit this one as well.

%% \subsubsection{ùîâ ‚Ü™ ‚Ñ≠}\label{sssec:lemma-3}
After these first two lemmas are formally verified (see~\cite{DeMeo:2021} or \ualibdotorg for proofs), we arrive at a step in the formalization of Birkhoff's theorem that turns out to be surprisingly nontrivial. We must show that the relatively free algebra \af ùîâ embeds in the product \af ‚Ñ≠ of all subalgebras of algebras in the given class \ab ùí¶.  We begin by constructing \af ‚Ñ≠, using the class-product types described in \S\ref{ssec:class-products-and-inclusions}. Observe that the elements of \af ‚Ñ≠ are maps from \af{‚Ñës} to \as{\{}\af{ùîÑs} \ab i \as : \ab i \as ‚àà \af{‚Ñës}\as{\}}.
\ccpad
\begin{code}%
\>[1]\AgdaFunction{‚Ñës}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Ãá}}\AgdaSpace\AgdaComment{-- for indexing over all subalgebras of algebras in ùí¶}\<%
\\
%
\>[1]\AgdaFunction{‚Ñës}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚Ñë}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{S}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaBound{ùì§}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{)}\<%
\\
%
\>[1]\AgdaFunction{ùîÑs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñës}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaBound{ùì§}\AgdaSpace{}%
\AgdaBound{ùëÜ}\<%
\\
%
\>[1]\AgdaFunction{ùîÑs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñës}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Algebra}\AgdaSpace{}%
\AgdaFunction{ovùìæ}\AgdaSpace{}%
\AgdaBound{ùëÜ}\AgdaSpace{}\AgdaComment{-- the product of all subalgebras of algebras in ùí¶}\<%
\\
%
\>[1]\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{‚®Ö}\AgdaSpace{}%
\AgdaFunction{ùîÑs}\<%
\end{code}
\ccpad
Next, we construct an embedding \af ùî£ from \af ùîâ into \af ‚Ñ≠ using a \ualib tool called \AgdaFunction{ùîâ-free-lift}.
\ccpad
\begin{code}
\>[1]\AgdaFunction{ùî•‚ÇÄ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{ùî•‚ÇÄ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fst}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ùïè}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîÑs}\AgdaSpace{}%
\AgdaBound{i}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[1]\AgdaFunction{œïùî†}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùëª}\AgdaSpace{}%
\AgdaBound{X}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\<%
\\
%
\>[1]\AgdaFunction{œïùî†}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{lift-hom}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaFunction{ùî•‚ÇÄ}\<%
\\
%
\>[1]\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{hom}\AgdaSpace{}%
\AgdaFunction{ùîâ}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\<%
\\
%
\>[1]\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ùîâ-free-lift}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaFunction{ùî•‚ÇÄ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{Œª}\AgdaSpace{}%
\AgdaBound{ùëì}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{œïùî†}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaBound{ùëì}\AgdaSpace{}%
\AgdaSymbol{(Œª}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚åú}}\AgdaSpace{}%
\AgdaBound{ùíÇ}\AgdaSpace{}%
\AgdaBound{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚åù}}\AgdaSymbol{)}\<%
\end{code}
\ccpad
The hard part is showing that \af ùî£ is a monomorphism. For lack of space, we must omit the inner workings of the proof, and settle for the outer shell. \seedocfordetails
For ease of notation, let \AgdaFunction{Œ®}\AgdaSpace{}\AgdaSymbol{=}\AgdaSpace{}\AgdaFunction{œàRel}\AgdaSpace{}\AgdaBound{ùí¶}.
%% \input{aux/notation.tex}
%% \subsubsection{ùîâ ‚â§ ‚Ñ≠}\label{sssec:lemma-3}
%% Armed with these tools, we proceed to the proof that the free algebra \af ùîâ is a subalgebra of the product ‚Ñ≠ of all subalgebras of algebras in ùí¶. 
\ccpad
\begin{code}%
\>[1]\AgdaFunction{monùî£}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Monic}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[1]\AgdaFunction{monùî£}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaFunction{Œ®}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{p}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDottedPattern{\AgdaSymbol{.(}}\AgdaDottedPattern{\AgdaFunction{Œ®}}\AgdaSpace{}%
\AgdaDottedPattern{\AgdaBound{q}}\AgdaDottedPattern{\AgdaSymbol{)}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaBound{fpq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Œ≥}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2] \AgdaComment{... details omitted ...}%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{Œ≥}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Œ®}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùìá‚ÑØùíªùìÅ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{‚â°}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaFunction{Œ®}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{ùìá‚ÑØùíªùìÅ}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{Œ≥}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{class-extensionality'}\AgdaSpace{}%
\AgdaBound{pe}\AgdaSpace{}%
\AgdaBound{gfe}\AgdaSpace{}%
\AgdaBound{ssR}\AgdaSpace{}%
\AgdaBound{ssA}\AgdaSpace{}%
\AgdaFunction{œàIsEquivalence}\AgdaSpace{}%
\AgdaFunction{pŒ®q}\<%
\end{code}
\ccpad
Assuming the foregoing, the proof that \af ùîâ is (isomorphic to) a subalgebra of \af ‚Ñ≠ would be completed as follows.
\ccpad
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[1]\AgdaFunction{ùîâ‚â§‚Ñ≠}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ùîâ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚â§}}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\<%
\\
%
\>[1]\AgdaFunction{ùîâ‚â§‚Ñ≠}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{embùî£}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSpace{}%
\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à•}}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{embùî£}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-embedding}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\<%
\\
%
\>[3]\AgdaFunction{embùî£}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{monic-into-set-is-embedding}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{ùî£}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{monùî£}\<%
\end{code}

%% \subsubsection{ùîâ ‚àà V(ùí¶)}\label{sssec:lemma-4}
With the foregoing results in hand, along with what we proved earlier---namely, that \ad P\ad S(\ab ùí¶) \af ‚äÜ \ad S\ad P(\ab ùí¶) \af ‚äÜ \ad V(\ab ùí¶)---it is not hard to show that \af ùîâ belongs to \ad S\ad P(\ab ùí¶), and hence to \ad V(\ab ùí¶).
\ccpad
\begin{code}%
\>[1]\AgdaFunction{ùîâ‚ààSP}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ùîâ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{S}\AgdaSymbol{\{}\AgdaFunction{ovùìæ}\AgdaSymbol{\}\{}\AgdaFunction{ovùìæ}\AgdaOperator{\AgdaFunction{‚Å∫}}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{P}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaFunction{ovùìæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\<%
\\
%
\>[1]\AgdaFunction{ùîâ‚ààSP}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{ssub}\AgdaSpace{}%
\AgdaFunction{spC}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîâ‚â§‚Ñ≠}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSymbol{)}\<%
\\
\>[1][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaFunction{spC}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{S}\AgdaSymbol{\{}\AgdaFunction{ovùìæ}\AgdaSymbol{\}\{}\AgdaFunction{ovùìæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{P}\AgdaSymbol{\{}\AgdaBound{ùì§}\AgdaSymbol{\}\{}\AgdaFunction{ovùìæ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{ùí¶}\AgdaSymbol{))}\<%
\\
%
\>[3]\AgdaFunction{spC}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{class-prod-s-‚àà-sp}\AgdaSpace{}%
\AgdaBound{hfe}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[1]\AgdaFunction{ùîâ‚ààùïç}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{is-set}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaFunction{‚Ñ≠}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚à£}}\AgdaSpace{}%
\AgdaSymbol{‚Üí}\AgdaSpace{}%
\AgdaFunction{ùîâ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{‚àà}}\AgdaSpace{}%
\AgdaFunction{ùïç}\<%
\\
%
\>[1]\AgdaFunction{ùîâ‚ààùïç}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{SP‚äÜV'}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ùîâ‚ààSP}\AgdaSpace{}%
\AgdaBound{Cset}\AgdaSymbol{)}\<%
\end{code}
%% \ccpad
%% \begin{code}%

\subsection{The HSP Theorem}\label{ssec:hsp-theorem}
%% This section presents the \ualibTheorem module of the \agdaualib that puts together all the pieces we have developed above to complete the formal proof of the HSP theorem in type theory.
\input{aux/birkhoff-theorem.tex}











%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%% Bibliography
\bibliography{ualib_refs}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%















\appendix

\input{aux/appendix.tex}


%% \section{Some Components of the Type Topology Library}
%% Here we collect some of the components from the \typetopology library that we used above but did not have space to discuss.  They are collected here for the reader's convenience and to keep the paper somewhat self-contained.

%% \input{aux/typetopology.tex}









%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document} %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



